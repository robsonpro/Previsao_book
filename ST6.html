<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="pt" xml:lang="pt"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Robson Bruno Dutra Pereira">

<title>6&nbsp; Modelos auto-regressivos integrados de médias móveis (ARIMA) – Séries Temporais e Previsão</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./ST7.html" rel="next">
<link href="./ST5.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "Nenhum resultado",
    "search-matching-documents-text": "documentos correspondentes",
    "search-copy-link-title": "Copiar link para a busca",
    "search-hide-matches-text": "Esconder correspondências adicionais",
    "search-more-match-text": "mais correspondência neste documento",
    "search-more-matches-text": "mais correspondências neste documento",
    "search-clear-button-title": "Limpar",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancelar",
    "search-submit-button-title": "Enviar",
    "search-label": "Procurar"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Alternar barra lateral" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./ST6.html"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Modelos auto-regressivos integrados de médias móveis (ARIMA)</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Alternar barra lateral" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Procurar" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Séries Temporais e Previsão</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Procurar"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Prefácio</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ST1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introdução e gráficos</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ST2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Análise descritiva, métodos simples de previsão e diagnóstico</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ST3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Decomposição de séries temporais</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ST4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Regressão de séries temporais</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ST5.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Suavização exponencial</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ST6.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Modelos auto-regressivos integrados de médias móveis (ARIMA)</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ST7.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Regressão dinâmica</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Referências</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Índice</h2>
   
  <ul>
  <li><a href="#estacionariedade-em-séries-temporais" id="toc-estacionariedade-em-séries-temporais" class="nav-link active" data-scroll-target="#estacionariedade-em-séries-temporais"><span class="header-section-number">6.1</span> Estacionariedade em séries temporais</a>
  <ul class="collapse">
  <li><a href="#diferenciação" id="toc-diferenciação" class="nav-link" data-scroll-target="#diferenciação"><span class="header-section-number">6.1.1</span> Diferenciação</a></li>
  <li><a href="#testes-de-raízes-unitárias" id="toc-testes-de-raízes-unitárias" class="nav-link" data-scroll-target="#testes-de-raízes-unitárias"><span class="header-section-number">6.1.2</span> Testes de raízes unitárias</a></li>
  <li><a href="#operador-de-defasagem" id="toc-operador-de-defasagem" class="nav-link" data-scroll-target="#operador-de-defasagem"><span class="header-section-number">6.1.3</span> Operador de defasagem</a></li>
  </ul></li>
  <li><a href="#modelos-autorregressivos" id="toc-modelos-autorregressivos" class="nav-link" data-scroll-target="#modelos-autorregressivos"><span class="header-section-number">6.2</span> Modelos autorregressivos</a></li>
  <li><a href="#modelos-de-média-móvel" id="toc-modelos-de-média-móvel" class="nav-link" data-scroll-target="#modelos-de-média-móvel"><span class="header-section-number">6.3</span> Modelos de média móvel</a></li>
  <li><a href="#modelos-arima-não-sazonais" id="toc-modelos-arima-não-sazonais" class="nav-link" data-scroll-target="#modelos-arima-não-sazonais"><span class="header-section-number">6.4</span> Modelos ARIMA não sazonais</a></li>
  <li><a href="#autocorrelação-parcial" id="toc-autocorrelação-parcial" class="nav-link" data-scroll-target="#autocorrelação-parcial"><span class="header-section-number">6.5</span> Autocorrelação parcial</a>
  <ul class="collapse">
  <li><a href="#modelagem-e-seleção-de-modelos" id="toc-modelagem-e-seleção-de-modelos" class="nav-link" data-scroll-target="#modelagem-e-seleção-de-modelos"><span class="header-section-number">6.5.1</span> Modelagem e seleção de modelos</a></li>
  </ul></li>
  <li><a href="#arima-com-sazonalidade" id="toc-arima-com-sazonalidade" class="nav-link" data-scroll-target="#arima-com-sazonalidade"><span class="header-section-number">6.6</span> ARIMA com sazonalidade</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Modelos auto-regressivos integrados de médias móveis (ARIMA)</span></h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Autor</div>
    <div class="quarto-title-meta-contents">
             <p>Robson Bruno Dutra Pereira </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="estacionariedade-em-séries-temporais" class="level2" data-number="6.1">
<h2 data-number="6.1" class="anchored" data-anchor-id="estacionariedade-em-séries-temporais"><span class="header-section-number">6.1</span> Estacionariedade em séries temporais</h2>
<p>As séries temporais estacionárias são aquelas que não apresentam tendência ou sazonalidade, de forma que suas propriedades não dependam do tempo. Um ruído branco é um exemplo de série estacionária. Algumas séries cíclicas podem ser estacionárias, caso os picos e vales não sejam previsíveis devido a variabilidade na dimensão do ciclo.</p>
<p>A <a href="#fig-series" class="quarto-xref">Figura&nbsp;<span>6.1</span></a> expõe exemplos de séries temporais estacionária. À esquerda observa-se um ruído branco, no centro uma série com tendência, sendo esta a série do valor de fechamento da ação PETR3 da Petrobrás e, à direita uma série com sazonalidade, neste caso uma série de produção de energia solar no Brasil para os primeiros dias de dezembro de 2023, com frequência horária.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-series" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-series-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="ST6_files/figure-html/fig-series-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-series-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;6.1: Exemplos de séries temporais estacionária, com tendência e sazonalidade
</figcaption>
</figure>
</div>
</div>
</div>
<section id="diferenciação" class="level3" data-number="6.1.1">
<h3 data-number="6.1.1" class="anchored" data-anchor-id="diferenciação"><span class="header-section-number">6.1.1</span> Diferenciação</h3>
<p>A diferenciação é útil para tornar uma série não estacionária em estacionária. Ela serve para remover a variação no nível de uma série, estabilizando sua média.</p>
<p>A série diferenciada consiste na mudança entre observações subsequentes, contendo esta ao final <span class="math inline">\(T-1\)</span> observações.</p>
<p><span class="math display">\[
y_t' = y_t-y_{t-1}
\]</span></p>
<p>Se a série diferenciada consiste em um ruído branco, <span class="math inline">\(\varepsilon_t\)</span>, então pode-se escrever:</p>
<p><span class="math display">\[
y_t-y_{t-1} = \varepsilon_t
\]</span></p>
<p>Um modelo onde a observação posterior é igual à anterior adicionada de um ruído branco é chamado de caminhada aleatória (<em>random walk</em>). O modelo de caminhada aleatória estima a próxima observação igual à anterior, <span class="math inline">\(\hat y_t = y_{t-1}\)</span>, conforme o método ingênuo. No caso de média não nula, como a maior parte das séries, pode-se considerar uma constante, conforme segue, onde a constante, <span class="math inline">\(c\)</span>, consiste na média das diferenças.</p>
<p><span class="math display">\[
y_t-y_{t-1} = \varepsilon_t + c
\]</span></p>
<p>A <a href="#fig-difcor" class="quarto-xref">Figura&nbsp;<span>6.2</span></a> expõe a série não estacionária para o índice Ibovespa, além da série obtida a partir da diferenciação desta, a qual consiste na variação diária do índice. A série diferenciada apresenta estacionariedade. A Figura exibe também os correlagramas da série original e da diferenciada. Observa-se que a série diferenciada, ao contrário da original, não apresenta autocorrelação.</p>
<p><span class="math display">\[
y_t-y_{t-1} = c+\varepsilon_t
\]</span></p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-difcor" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-difcor-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="ST6_files/figure-html/fig-difcor-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-difcor-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;6.2: Série temporal não estacionária, diferenciação e autocorrelação
</figcaption>
</figure>
</div>
</div>
</div>
<p>O modelo de caminhada aleatória é muito útil para séries econométricas e de finanças. Geralmente tais séries apresentam longos períodos de tendência de queda ou crescimento, com mudanças inesperadas de difícil explicação.</p>
<p>Em casos onde a diferenciação de primeira ordem não garante a estacionariedade, pode-se ainda aplicar uma diferenciação de segunda ordem.</p>
<p><span class="math display">\[
\begin{align}
y_t'' &amp;= y_t'-y_{t-1}' \\
      &amp;= (y_t-y_{t-1})-(y_{t-1}-y_{t-2}) \\
      &amp;= y_t-2y_{t-1}+y_{t-2}
\end{align}
\]</span></p>
<p>Em séries sazonais é importante aplicar a diferenciação sazonal conforme segue, onde <span class="math inline">\(m\)</span> é o número de períodos sazonais.</p>
<p><span class="math display">\[
y_t'= y_t - y_{t-m}
\]</span></p>
<p>A <a href="#fig-voosdiff" class="quarto-xref">Figura&nbsp;<span>6.3</span></a> apresenta a série de passageiros em vôos do Brasil. Foi aplicado logaritmo para estabilizar a variação anual. Posteriormente, foi realizada diferenciação sazonal, <span class="math inline">\(m=12\)</span> e, em seguida, outra diferenciação porém mensal, de forma a garantir a estacionariedade. Logo, neste caso, a diferenciação anual trata a sazonalidade e a mensal a tendência.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-voosdiff" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-voosdiff-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="ST6_files/figure-html/fig-voosdiff-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-voosdiff-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;6.3: Passageiros em vôos do Brasil: série original, log da série, variação sazonal e variação de segunda ordem
</figcaption>
</figure>
</div>
</div>
</div>
<p>Tomando a diferenciação de primeira ordem como sendo sazonal, <span class="math inline">\(y' = y_t-y_{t-m}\)</span>, então a diferenciação de segunda ordem, fica:</p>
<p><span class="math display">\[
\begin{align}
y'' &amp;= y'-y'_{t-1} \\
    &amp;= (y_t-y_{t-m})-(y_{t-1}-y_{t-m-1}) \\
    &amp;= y_t - y_{t-m} -y_{t-1}+y_{t-m-1} \\
\end{align}
\]</span></p>
</section>
<section id="testes-de-raízes-unitárias" class="level3" data-number="6.1.2">
<h3 data-number="6.1.2" class="anchored" data-anchor-id="testes-de-raízes-unitárias"><span class="header-section-number">6.1.2</span> Testes de raízes unitárias</h3>
<p>Os testes de raízes unitárias servem para avaliar se a série apresenta ou não estacionariedade. O teste de Kwiatkowski-Phillips-Schmidt-Shin (KPSS) é uma opção, com a hipótese nula indicando a estacionariedade da série. A saída do teste reporta 0,01, se o p-valor for menor que 0.01 e reporta 0.1, se o p-valor for maior que 0,1. A <a href="#tbl-kpss1" class="quarto-xref">Tabela&nbsp;<span>6.1</span></a> apresenta o resultado do teste para a série do índice Ibovespa, indicando a rejeição da hipótese nula de estacionariedade, sendo necessária a diferenciação da série.</p>
<div class="cell">
<div id="tbl-kpss1" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-kpss1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Tabela&nbsp;6.1: Teste KPSS para o índice Ibovespa
</figcaption>
<div aria-describedby="tbl-kpss1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">kpss_stat</th>
<th style="text-align: right;">kpss_pvalue</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">0.7490546</td>
<td style="text-align: right;">0.01</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
</section>
<section id="operador-de-defasagem" class="level3" data-number="6.1.3">
<h3 data-number="6.1.3" class="anchored" data-anchor-id="operador-de-defasagem"><span class="header-section-number">6.1.3</span> Operador de defasagem</h3>
<p>O operador ou notação de defasagem (<em>backward shift notation</em> - <span class="math inline">\(B\)</span>) é útil para trabalhar com diferenciação, defasagem (<em>lag</em>) e para representação de modelos ARIMA. O operador <span class="math inline">\(B\)</span> em <span class="math inline">\(y_t\)</span> defasa a observação em um período no tempo:</p>
<p><span class="math display">\[
By_t = y_{t-1}
\]</span></p>
<p>No caso de defasagem de segunda ordem, tem-se:</p>
<p><span class="math display">\[
B(By_t) = B^2y_t = y_{t-2}
\]</span></p>
<p>Para caso sazonal, por exemplo em séries de frquência horária e sazonalidade diária, pode ser útil usar <span class="math inline">\(B^{24}y_t = y_{t-24}\)</span>, de forma a retornar na mesma hora no dia anterior.</p>
<p>A diferenciação de primeira ordem com tal notação pode ser escrita como:</p>
<p><span class="math display">\[
\begin{align}
y'_t &amp;= y_t-y_{t-1} \\
     &amp;=y_t-By_t \\
     &amp;=(1-B)y_t
\end{align}
\]</span></p>
<p>De forma análoga, a diferenciação de segunda ordem fica:</p>
<p><span class="math display">\[
\begin{align}
y_t'' &amp;= y_t-2y_{t-1}+y_{t-2} \\
      &amp;= y_t-2By_t+B^2y_t \\
      &amp;= (1-B)^2y_t
\end{align}
\]</span></p>
</section>
</section>
<section id="modelos-autorregressivos" class="level2" data-number="6.2">
<h2 data-number="6.2" class="anchored" data-anchor-id="modelos-autorregressivos"><span class="header-section-number">6.2</span> Modelos autorregressivos</h2>
<p>Um modelo autorregressivo consiste em um modelo de regressão para a série, <span class="math inline">\(y_t\)</span>, em função do seu passado, ou para termos defasados, <span class="math inline">\(y_{t-1}, y_{t-2}, ..., y_{t-p}\)</span>. Um modelo autorregressivo de ordem <span class="math inline">\(p\)</span> ou <span class="math inline">\(AR(p)\)</span> pode ser escrito como:</p>
<p><span class="math display">\[
\begin{align}
y_t &amp;= c+\phi_1y_{t-1} + \phi_2y_{t-2} + \ldots + \phi_py_{t-p} + \varepsilon_t \\
    &amp;= c+\phi_1By_t + \phi_2B^2y_t + \ldots + \phi_pB^py_t + \varepsilon_t \\
&amp;(1-\phi_1B- \phi_2B^2 - \ldots - \phi_pB^p)y_t = \varepsilon_t \\
\end{align}
\]</span></p>
<p>A Figura <a href="#fig-ar" class="quarto-xref">Figura&nbsp;<span>6.4</span></a> expõe séries temporais que seguem processos autorregressivos <span class="math inline">\(AR(1)\)</span> e <span class="math inline">\(AR(2)\)</span>. Na <a href="#fig-ar" class="quarto-xref">Figura&nbsp;<span>6.4</span></a>(a) tem-se um processo autorregressivo de primeira ordem, <span class="math inline">\(AR(1)\)</span>, com <span class="math inline">\(y_t=15-0.5y_{t-1}+\varepsilon_t\)</span>. Na Figura <a href="#fig-ar" class="quarto-xref">Figura&nbsp;<span>6.4</span></a>(b) tem-se um processo autorregressivo de segunda ordem, <span class="math inline">\(AR(2)\)</span>, com <span class="math inline">\(y_t = 8+1.3y_{t-1}-0.7y_{t-2}+\varepsilon_t\)</span>.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-ar" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-ar-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="ST6_files/figure-html/fig-ar-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-ar-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;6.4: Processos autorregressivos
</figcaption>
</figure>
</div>
</div>
</div>
<p>Os processos autorregressivos são muito flexíveis. A mudança dos parâmetros <span class="math inline">\(\phi_1,..., \phi_p\)</span> pode resultar em padrões muito distintos.</p>
<p>Para um modelo <span class="math inline">\(AR(1)\)</span>, <span class="math inline">\(y_t=c+\phi_1y_{t-1} + \varepsilon_t\)</span>:</p>
<ul>
<li>Se <span class="math inline">\(c=0\)</span> e <span class="math inline">\(\phi_1=0\)</span>, tem-se um ruído branco.</li>
<li>Se <span class="math inline">\(c=0\)</span> e <span class="math inline">\(\phi_1=1\)</span>, tem-se uma caminhada aleatória.</li>
<li>Se <span class="math inline">\(c\neq0\)</span> e <span class="math inline">\(\phi_1=1\)</span>, tem-se uma caminhada aleatória com deriva.</li>
<li>Se <span class="math inline">\(\phi_1&lt;1\)</span>, <span class="math inline">\(y_t\)</span> tende a oscilar em torno da média.</li>
</ul>
<p>Os processos autorregressivos são usados para séries estacionárias, sendo algumas restrições impostas:</p>
<ul>
<li>Para um modelo <span class="math inline">\(AR(1)\)</span>: <span class="math inline">\(-1&lt;\phi_1&lt;1\)</span>.</li>
<li>Para um modelo <span class="math inline">\(AR(2)\)</span>: <span class="math inline">\(-1&lt;\phi_2&lt;1\)</span>, <span class="math inline">\(\phi_1+\phi_2&lt;1\)</span>, <span class="math inline">\(\phi_2+\phi_1&lt;1\)</span>.</li>
</ul>
</section>
<section id="modelos-de-média-móvel" class="level2" data-number="6.3">
<h2 data-number="6.3" class="anchored" data-anchor-id="modelos-de-média-móvel"><span class="header-section-number">6.3</span> Modelos de média móvel</h2>
<p>Um modelo de média móvel considera os erros passados ao invés das observações passadas, sendo um modelo de média móvel de ordem <span class="math inline">\(q\)</span>, <span class="math inline">\(MA(q)\)</span> definido conforme segue:</p>
<p><span class="math display">\[
\begin{align}
y_t&amp;=c+\varepsilon_t+\theta_1\varepsilon_{t-1} + \theta_2\varepsilon_{t-2} + \ldots + \theta_q\varepsilon_{t-q}\\
&amp;=c+\varepsilon_t+\theta_1B\varepsilon_t+\theta_2B^2\varepsilon_t+\ldots+\theta_qB^q\varepsilon_t \\
&amp;=c+ (1+\theta_1B+\theta_2B^2+\ldots+\theta_qB^q)\varepsilon_t
\end{align}
\]</span></p>
<p>Como os valores do erro não são observados este modelo não é uma regressão habitual.</p>
<p>É importante também diferenciar os modelos <span class="math inline">\(MA(q)\)</span> dos modelos de média móvel para suavização. Enquanto os modelos aqui apresentados tem o objetivo de realizar previsões, os modelos de suavização visam estimar a tendência de observações passadas de séries temporais.</p>
<p>A Figura <a href="#fig-ma" class="quarto-xref">Figura&nbsp;<span>6.5</span></a> ilustra processos de média móvel. Na <a href="#fig-ma" class="quarto-xref">Figura&nbsp;<span>6.5</span></a>(a) um processo de média móvel de primeira ordem, <span class="math inline">\(MA(1)\)</span>, é observado com <span class="math inline">\(y_t = 15 + \varepsilon_t + 0.6\varepsilon_{t-1}\)</span>. Na <a href="#fig-ma" class="quarto-xref">Figura&nbsp;<span>6.5</span></a>(b) tem-se um processo de média móvel de segunda ordem, <span class="math inline">\(MA(2)\)</span>, com <span class="math inline">\(y_t = 8 + \varepsilon_t - 0.9\varepsilon_{t-1} + 0.5\varepsilon_{t-2}\)</span>. Mudando os parâmetros <span class="math inline">\(\theta_1, ..., \theta_q\)</span> a série varia significativamente. Assim como nos modelos autorregressivos, nos de média móvel a variância do erro <span class="math inline">\(\sigma_\varepsilon\)</span> só muda a amplitude da série, não o padrão.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-ma" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-ma-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="ST6_files/figure-html/fig-ma-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-ma-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;6.5: Processos de média móvel
</figcaption>
</figure>
</div>
</div>
</div>
<p>Qualquer processo estacionário <span class="math inline">\(AR(p)\)</span> pode ser escrito como um processo <span class="math inline">\(MA(\infty)\)</span>. Para o caso <span class="math inline">\(AR(1)\)</span>, tem-se:</p>
<p><span class="math display">\[
\begin{align}
y_t &amp;= \phi_1y_{t-1} + \varepsilon_t\\
    &amp;=  \phi_1(\phi_1y_{t-2} + \varepsilon_{t-1}) + \varepsilon_t\\
    &amp;= \phi_1^2y_{t-2} + \phi_1\varepsilon_{t-1} + \varepsilon_t\\
    &amp;= \phi_1^3y_{t-3} + \phi_1^2y_{t-2} + \phi_1\varepsilon_{t-1} + \varepsilon_t\\
    &amp;= ...\\
\end{align}
\]</span></p>
<p>À medida que <span class="math inline">\(k\)</span> aumenta, <span class="math inline">\(\phi_1^k\)</span> diminui, considerando <span class="math inline">\(-1&lt;\phi_1&lt;1\)</span>, de forma que o termo de potência maior pode ser desconsiderado. Fazendo <span class="math inline">\(\phi_1 = \theta_1\)</span>, <span class="math inline">\(\phi_1^2 = \theta_2\)</span> e assim sucessivamente, tem-se o modelo de média móvel inicialmente exposto. Impondo algumas restrições nos parâmetros do modelo <span class="math inline">\(MA(q)\)</span> é possível escrevê-lo como um processo <span class="math inline">\(AR(\infty)\)</span>.</p>
</section>
<section id="modelos-arima-não-sazonais" class="level2" data-number="6.4">
<h2 data-number="6.4" class="anchored" data-anchor-id="modelos-arima-não-sazonais"><span class="header-section-number">6.4</span> Modelos ARIMA não sazonais</h2>
<p>Um modelo autorregressivo integrado de média móvel (ARIMA) combina um modelo autorregressivo da série diferenciada e um de média móvel, conforme segue.</p>
<p><span class="math display">\[
\begin{align}
y_t'&amp;=c+\phi_1y'_{t-1} + \phi_2y'_{t-2} + \ldots + \phi_py'_{t-p} + \theta_1\varepsilon_{t-1} + \theta_2\varepsilon_{t-2} + \ldots + \theta_q\varepsilon_{t-q} + \varepsilon_t \\
&amp;= c+\phi_1By'_t + \phi_2B^2y'_t + \ldots + \phi_pB^py'_t+\theta_1B\varepsilon_t + \theta_2B^2\varepsilon_t + \ldots + \theta_qB^q\varepsilon_t + \varepsilon_t \\
&amp;(1-\phi_1B- \ldots - \phi_pB^p)(1-B)^dy_t = c+( 1+\theta_1B+\ldots+\theta_qB^q)\varepsilon_t
\end{align}
\]</span></p>
<p>Um modelo <span class="math inline">\(ARIMA(p,d,q)\)</span> consiste em um modelo com grau <span class="math inline">\(p\)</span> para a parte autorregressiva, com diferenciação de ordem <span class="math inline">\(d\)</span> e com grau <span class="math inline">\(q\)</span> para a parte de média móvel. A <a href="#tbl-casosarima" class="quarto-xref">Tabela&nbsp;<span>6.2</span></a> expõe a sintaxe do modelo ARIMA correspondente para alguns casos especiais.</p>
<div id="tbl-casosarima" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-casosarima-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Tabela&nbsp;6.2: Casos especiais e modelos ARIMA correspondentes
</figcaption>
<div aria-describedby="tbl-casosarima-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<thead>
<tr class="header">
<th>Caso especial</th>
<th>Modelo</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Ruído banco</td>
<td><span class="math inline">\(ARIMA(0,0,0)\)</span> sem cte</td>
</tr>
<tr class="even">
<td>Caminhada aleatória</td>
<td><span class="math inline">\(ARIMA(0,1,0)\)</span> sem cte</td>
</tr>
<tr class="odd">
<td>Caminhada aleatória com deriva</td>
<td><span class="math inline">\(ARIMA(0,1,0)\)</span> com cte</td>
</tr>
<tr class="even">
<td>Autorregressão</td>
<td><span class="math inline">\(ARIMA(p,0,0)\)</span></td>
</tr>
<tr class="odd">
<td>Média móvel</td>
<td><span class="math inline">\(ARIMA(0,0,q)\)</span></td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
<p>A <a href="#fig-coque" class="quarto-xref">Figura&nbsp;<span>6.6</span></a> expõe a série temporal do volume de produção de coque no Brasil a partir de 2021.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-coque" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-coque-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="ST6_files/figure-html/fig-coque-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-coque-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;6.6: Volume de produção de coque no Brasil
</figcaption>
</figure>
</div>
</div>
</div>
<p>É difícil selecionar apropriadamente os valores adequados de <span class="math inline">\(p,d,q\)</span> para uma série ao se estimar um modelo ARIMA. O pacote <code>fable</code> auxilia na otimização destes parâmetros segundo a série em análise. A seguir expõe-se o resultado do modelo ARIMA obtido automaticamente.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Series: value 
Model: ARIMA(1,0,0) w/ mean 

Coefficients:
         ar1    constant
      0.2763  271035.558
s.e.  0.1433    4547.139

sigma^2 estimated as 969282769:  log likelihood=-516.68
AIC=1039.35   AICc=1039.95   BIC=1044.7</code></pre>
</div>
</div>
<p>Foi obtido um modelo ARIMA(1,0,0) exposto a seguir, onde <span class="math inline">\(\varepsilon_t\)</span> é ruído branco com <span class="math inline">\(\sigma_\varepsilon = 31133,31\)</span>.</p>
<p><span class="math display">\[
y_t = 271035,56 + 0,28y_{t-1} + \varepsilon_t
\]</span></p>
<p>A <a href="#fig-for_fitcoque" class="quarto-xref">Figura&nbsp;<span>6.7</span></a> expõe a previsão de 10 meses à frente usando tal modelo.</p>
<div class="cell" data-tbl-cap="Previsão para 10 meses via ARIMA para a série de volume de produção de coque no Brasil">
<div class="cell-output-display">
<div id="fig-for_fitcoque" class="quarto-float quarto-figure quarto-figure-center anchored" width="672">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-for_fitcoque-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="ST6_files/figure-html/fig-for_fitcoque-1.png" id="fig-for_fitcoque" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-for_fitcoque-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;6.7
</figcaption>
</figure>
</div>
</div>
</div>
<p>A <a href="#fig-vale20" class="quarto-xref">Figura&nbsp;<span>6.8</span></a> expõe a série temporal do valor da ação VALE3 a partir de 2020.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-vale20" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-vale20-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="ST6_files/figure-html/fig-vale20-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-vale20-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;6.8: Série temporal do valor da ação VALE3
</figcaption>
</figure>
</div>
</div>
</div>
<p>Abaixo expõe-se o modelo ARIMA obtido para a série.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Series: Valor 
Model: ARIMA(2,0,2) w/ mean 

Coefficients:
         ar1      ar2      ma1     ma2  constant
      1.4603  -0.7901  -0.6441  0.4800   23.9391
s.e.  0.1549   0.1356   0.2359  0.1225    0.5966

sigma^2 estimated as 25.64:  log likelihood=-135.27
AIC=282.53   AICc=284.74   BIC=293.37</code></pre>
</div>
</div>
<p>Foi obtido um modelo <span class="math inline">\(ARIMA(2,0,2)\)</span>:</p>
<p><span class="math display">\[
y_t = 23,94 + 1,46y_{t-1} - 0,79y_{t-2} -0,64\varepsilon_{t-1} + 0,48\varepsilon_{t-2} + \varepsilon_t
\]</span></p>
<p>A <a href="#fig-resi" class="quarto-xref">Figura&nbsp;<span>6.9</span></a> expõe os gráficos dos resíduos do modelo ARIMA(2,0,2) aplicado à série do preço da ação VALE3. Observa-se um padrão de ruído branco, com ausência de autocorrelação.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-resi" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-resi-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="ST6_files/figure-html/fig-resi-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-resi-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;6.9: Resíduos do modelo ARIMA(2,0,2) para a série do valor da ação VALE3
</figcaption>
</figure>
</div>
</div>
</div>
<p>Conforme <a href="#fig-for_vale10" class="quarto-xref">Figura&nbsp;<span>6.10</span></a>, dada a previsão 10 meses à frente exibida, o modelo capturou bem o padrão cíclico não sazonal da série.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-for_vale10" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-for_vale10-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="ST6_files/figure-html/fig-for_vale10-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-for_vale10-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;6.10: Série temporal do valor da ação VALE3
</figcaption>
</figure>
</div>
</div>
</div>
<p>A previsão em modelos ARIMA é realizada usando o modelo ARIMA obtido, considerando <span class="math inline">\(T = T+h\)</span>, onde <span class="math inline">\(h\)</span> é o número de períodos à frente das observações disponíveis. Para o modelo ARIMA genérico exposto, considerando <span class="math inline">\(h=1\)</span>, tem-se o resultado à seguir, onde o termo de erro para <span class="math inline">\(t=T+1\)</span> é considerado nulo, <span class="math inline">\(\varepsilon_{T+1}=0\)</span>.</p>
<p><span class="math display">\[
\begin{align}
y_{T+1}'&amp;=c+\phi_1y'_{T} + \phi_2y'_{T-2} + \ldots + \phi_py'_{T+1-p} + \theta_1\varepsilon_{T} + \theta_2\varepsilon_{T-1} + \ldots + \theta_q\varepsilon_{T+1-q} + \varepsilon_{T+1} \\
y_{T+1}'&amp;=c+\phi_1y'_{T} + \phi_2y'_{T-2} + \ldots + \phi_py'_{T+1-p} + \theta_1\varepsilon_{T} + \theta_2\varepsilon_{T-1} + \ldots + \theta_q\varepsilon_{T+1-q}
\end{align}
\]</span></p>
<p>Em um modelo ARIMA se <span class="math inline">\(c=0\)</span> e <span class="math inline">\(d=0\)</span>, então a previsão de longo prazo tenderá para zero. Se <span class="math inline">\(c=0\)</span> e <span class="math inline">\(d=1\)</span>, a previsão a longo prazo tenderá para uma constante. Se <span class="math inline">\(c=0\)</span> e <span class="math inline">\(d=2\)</span>, a previsão a longo prazo será linear. Se <span class="math inline">\(c\neq0\)</span> e <span class="math inline">\(d=0\)</span>, a previsão a longo prazo será a média das observações. Se <span class="math inline">\(c\neq0\)</span> e <span class="math inline">\(d=1\)</span> a previsão a longo prazo será linear. Para previsões cíclicas é importante <span class="math inline">\(p\geq2\)</span>.</p>
</section>
<section id="autocorrelação-parcial" class="level2" data-number="6.5">
<h2 data-number="6.5" class="anchored" data-anchor-id="autocorrelação-parcial"><span class="header-section-number">6.5</span> Autocorrelação parcial</h2>
<p>A autocorrelação <span class="math inline">\(r_k\)</span> mede a relação linear entre a série original <span class="math inline">\(y_t\)</span> e a série defasada <span class="math inline">\(y_{t-k}\)</span>. Entretanto, se <span class="math inline">\(y_t\)</span> e <span class="math inline">\(y_{t-1}\)</span> são correlacionadas, então <span class="math inline">\(y_{t-1}\)</span> e <span class="math inline">\(y_{t-2}\)</span> também o serão. Logo, haverá correlação entre <span class="math inline">\(y_t\)</span> e <span class="math inline">\(y_{t-2}\)</span>. Porém, não porque há uma explicação plausível para <span class="math inline">\(y_t\)</span> a partir de <span class="math inline">\(y_{t-2}\)</span>, mas simplesmente porque ambas estão relacionadas indiretamente por <span class="math inline">\(y_{t-1}\)</span>.</p>
<p>A autocorrelação parcial visa corrigir o problema da autocorrelação, medindo mais diretamente a relação linear entre <span class="math inline">\(y_t\)</span> e <span class="math inline">\(y_{t-k}\)</span> desconsiderando os efeitos das defasagens anteriores, <span class="math inline">\(1,2,\ldots, k-1\)</span>.</p>
<p>A <a href="#fig-acfpacf" class="quarto-xref">Figura&nbsp;<span>6.11</span></a> expõe os correlogramas de autocorrelação (ACF) e de autocorrelação parcial (PACF) da série do preço da ação VALE3. Observa-se um padrão sinusoidal em ambos correlogramas e última autocorrelação parcial significativa com <span class="math inline">\(k=3\)</span>.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-acfpacf" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-acfpacf-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="ST6_files/figure-html/fig-acfpacf-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-acfpacf-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;6.11: Autocorrelação e autocorrelação parcial da série VALE3
</figcaption>
</figure>
</div>
</div>
</div>
<p>Os correlogramas de ACF e PACF podem auxiliar na definição da ordem do modelo ARIMA em casos <span class="math inline">\(ARIMA(0,d,q)\)</span> e <span class="math inline">\(ARIMA(p,d,0)\)</span>. Para séries que seguem um padrão <span class="math inline">\(ARIMA(0,d,q)\)</span>:</p>
<ul>
<li>A autocorrelação parcial (PACF) decai exponencialmente ou tem padrão senoidal;</li>
<li>Há significância na autocorrelação (ACF) de lag <span class="math inline">\(q\)</span>, mas não além deste.</li>
</ul>
<p>Para séries que seguem um padrão <span class="math inline">\(ARIMA(p,d,0)\)</span>:</p>
<ul>
<li>A autocorrelação (ACF) decai exponencialmente ou tem padrão senoidal;</li>
<li>Há significância na autocorrelação parcial (PACF) de lag <span class="math inline">\(p\)</span>, mas não além deste.</li>
</ul>
<p>A seguir apresenta-se o resultado do modelo ARIMA(3,0,0) indicado pela interpretação dos correlogramas da Figura <a href="#fig-acfpacf" class="quarto-xref">Figura&nbsp;<span>6.11</span></a>. O modelo obtido apresentou resultado para <span class="math inline">\(ACCc\)</span> muito próximo ao obtido pela estimativa automática apresentado anteriormente.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Series: Valor 
Model: ARIMA(3,0,0) w/ mean 

Coefficients:
         ar1     ar2      ar3  constant
      0.8779  0.1577  -0.4693   31.4916
s.e.  0.1268  0.1812   0.1290    0.7465

sigma^2 estimated as 26.71:  log likelihood=-136.62
AIC=283.25   AICc=284.78   BIC=292.28</code></pre>
</div>
</div>
<section id="modelagem-e-seleção-de-modelos" class="level3" data-number="6.5.1">
<h3 data-number="6.5.1" class="anchored" data-anchor-id="modelagem-e-seleção-de-modelos"><span class="header-section-number">6.5.1</span> Modelagem e seleção de modelos</h3>
<p>Os modelos ARIMA podem ser estimados de distintas formas. Para um modelo de ordem <span class="math inline">\(p,d,q\)</span> pode-se maximizar o log da máxima verossimilhança para estimar os parâmetros <span class="math inline">\(c\)</span>, <span class="math inline">\(\phi_1,\ldots,\phi_p\)</span> e <span class="math inline">\(\theta_1,\ldots,\theta_q\)</span>, conforme feito no pacote <code>fable</code>. É importante esclarecer que existem distintos algoritmos e <em>softwares</em> diferentes podem não reportar os mesmos resultados.</p>
<p>Para comparar e selecionar modelos pode-se considerar o critério de informação de Akaike (AIC), calculado conforme segue, onde <span class="math inline">\(k=0\)</span>, se <span class="math inline">\(c=0\)</span>, e <span class="math inline">\(k=1\)</span>, caso contrário.</p>
<p><span class="math display">\[
AIC = -2\text{log}(L) + 2(p+k+q+1)
\]</span></p>
<p>O AIC corrigido (<span class="math inline">\(AICc\)</span>) é calculado conforme segue.</p>
<p><span class="math display">\[
AIC_c = AIC+ \frac{2(p+k+q+1)(p+k+q+2)}{T-p-q-k-2}
\]</span></p>
<p>Outra métrica é o critério de informação Bayesiano (BIC):</p>
<p><span class="math display">\[
BIC = AIC + [\text{log}(T)-2](p+k+q+1)
\]</span></p>
<p>O modelo que minimizar tais métricas deve ser escolhido, sugerindo-se priorizar o <span class="math inline">\(AICc\)</span>.</p>
<p>Uma abordagem para seleção de modelos ARIMA para casos não sazonais pode seguir os seguintes passos:</p>
<ol type="1">
<li>Visualize a série e identifique observações não usuais;</li>
<li>Realize transformação de Box-Cox para estabilizar a variância, se necessário;</li>
<li>Para séries não estacionárias, sugere-se diferenciar a série até tornar os dados estacionários;</li>
<li>Examine a autocorrelação e tente identificar algum modelo <span class="math inline">\(ARIMA(p,d,0)\)</span> via PACF ou <span class="math inline">\(ARIMA(0,d,q)\)</span> via ACF;</li>
<li>Selecione o modelo a partir do <span class="math inline">\(AICc\)</span>;</li>
<li>Avalie os resíduos do modelo selecionado;</li>
<li>Realize previsões com o modelo.</li>
</ol>
<p>Em caso de autocorrelação nos resíduos, tente ajustar outro modelo. Para exemplificar o procedimento, considere a série plotada na <a href="ST7.html#fig-graos" class="quarto-xref">Figura&nbsp;<span>7.6</span></a>, de produção de grãos no Brasil em toneladas. Como a série aparenta apresentar leve heterocedasticidade, será realizada transformação de Box-Cox.</p>
<p>A <a href="#fig-graos-bc" class="quarto-xref">Figura&nbsp;<span>6.13</span></a> apresenta a série após transformação com <span class="math inline">\(\lambda=0,6264\)</span>.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-graos" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-graos-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="ST6_files/figure-html/fig-graos-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-graos-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;6.12: Produção de grãos no Brasil em toneladas
</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="fig-graos-bc" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-graos-bc-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="ST6_files/figure-html/fig-graos-bc-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-graos-bc-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;6.13: Série de produção de grãos no Brasil com transformação de Box-Cox
</figcaption>
</figure>
</div>
</div>
</div>
<p>A <a href="#tbl-kpss_graos" class="quarto-xref">Tabela&nbsp;<span>6.3</span></a> apresenta o resultado do teste de KPSS para a série transformada, indicando a rejeição da hipótese nula de estacionariedade desta.</p>
<div class="cell">
<div id="tbl-kpss_graos" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-kpss_graos-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Tabela&nbsp;6.3: Teste KPSS para a série de produção de grãos
</figcaption>
<div aria-describedby="tbl-kpss_graos-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">kpss_stat</th>
<th style="text-align: right;">kpss_pvalue</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1.219482</td>
<td style="text-align: right;">0.01</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
<p>A <a href="#fig-graos-diff" class="quarto-xref">Figura&nbsp;<span>6.14</span></a> apresenta a variação da série transformada. Confirma-se estacionariedade após diferenciação de primeira ordem. Mesmo com a transformação de Box-Cox, após 2015 houve períodos de variação mais alta.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-graos-diff" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-graos-diff-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="ST6_files/figure-html/fig-graos-diff-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-graos-diff-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;6.14: Variação na produção de grãos no Brasil em toneladas
</figcaption>
</figure>
</div>
</div>
</div>
<p>A <a href="#fig-graos-autocorr" class="quarto-xref">Figura&nbsp;<span>6.15</span></a> expõe os correlogramas de ACF e PACF para a série diferenciada e transformada. Observa-se que o primeiro indica um modelo <span class="math inline">\(ARIMA(0,1,1)\)</span>, enquanto segundo indica um modelo <span class="math inline">\(ARIMA(1,1,0)\)</span>.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-graos-autocorr" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-graos-autocorr-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="ST6_files/figure-html/fig-graos-autocorr-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-graos-autocorr-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;6.15: Autocorrelação e autocorrelação parcial da série de produção de grãos
</figcaption>
</figure>
</div>
</div>
</div>
<p>A seguir expõe-se o resultado do modelo <span class="math inline">\(ARIMA(1,1,0)\)</span>. Foi obtido <span class="math inline">\(ACCc\)</span> = 585,42.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Series: valor 
Model: ARIMA(1,1,0) w/ drift 
Transformation: box_cox(valor, lambda) 

Coefficients:
          ar1  constant
      -0.4378  101.1837
s.e.   0.1329   19.3580

sigma^2 estimated as 17775:  log likelihood=-289.42
AIC=584.85   AICc=585.42   BIC=590.33</code></pre>
</div>
</div>
<p>A seguir expõe-se o resultado do modelo <span class="math inline">\(ARIMA(0,1,1)\)</span>. Foi obtido <span class="math inline">\(ACCc\)</span> = 586,36, indicando que o modelo anterior apresentou melhor ajuste.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Series: valor 
Model: ARIMA(0,1,1) w/ drift 
Transformation: box_cox(valor, lambda) 

Coefficients:
          ma1  constant
      -0.3959   69.2422
s.e.   0.1145   11.9141

sigma^2 estimated as 18159:  log likelihood=-289.89
AIC=585.79   AICc=586.36   BIC=591.27</code></pre>
</div>
</div>
<p>A <a href="#fig-resi-graos" class="quarto-xref">Figura&nbsp;<span>6.16</span></a> expõe os gráficos de resíduos para o modelo <span class="math inline">\(ARIMA(1,1,0)\)</span> aplicado à série diferenciada e transformada de produção de grãos. Os resíduos são não correlacionados e não aparentam apresentar desvio considerável de normalidade.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-resi-graos" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-resi-graos-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="ST6_files/figure-html/fig-resi-graos-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-resi-graos-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;6.16: Resíduos do modelo ARIMA(1,1,0) para a série de produção de grãos
</figcaption>
</figure>
</div>
</div>
</div>
<p>A <a href="#tbl-ljungbox-graos" class="quarto-xref">Tabela&nbsp;<span>6.4</span></a> resume o resultado do teste de Ljung-Box para os resíduos do modelo <span class="math inline">\(ARIMA(1,1,0)\)</span> para a série de produção de grãos. O teste deve ser realizado considerando <span class="math inline">\(K=p+q\)</span> graus de liberdade. O alto p-valor obtido indica não haver indícios para rejeição da hipótese nula de ausência de autocorrelação.</p>
<div class="cell">
<div id="tbl-ljungbox-graos" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-ljungbox-graos-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Tabela&nbsp;6.4: Teste de Ljung-Box para os resíduos do modelo ARIMA(1,1,0) para a série de produção de grãos
</figcaption>
<div aria-describedby="tbl-ljungbox-graos-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">.model</th>
<th style="text-align: right;">lb_stat</th>
<th style="text-align: right;">lb_pvalue</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">ARIMA(box_cox(valor, lambda) ~ pdq(1, 1, 0))</td>
<td style="text-align: right;">4.951101</td>
<td style="text-align: right;">0.8385499</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
<p>A <a href="#fig-for_graos" class="quarto-xref">Figura&nbsp;<span>6.17</span></a> expõe a previsão realizada para <span class="math inline">\(h=10\)</span> anos à frente com o modelo ajustado. A previsão pontual para 2033 é de 397000 toneladas de grãos.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-for_graos" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-for_graos-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="ST6_files/figure-html/fig-for_graos-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-for_graos-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;6.17: Previsão com o modelo ARIMA(1,1,0) para a série de produção de grãos
</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="arima-com-sazonalidade" class="level2" data-number="6.6">
<h2 data-number="6.6" class="anchored" data-anchor-id="arima-com-sazonalidade"><span class="header-section-number">6.6</span> ARIMA com sazonalidade</h2>
<p>Modelos ARIMA também podem ser aplicados a casos sazonais, sendo denotados <span class="math inline">\(ARIMA(p,d,q)(P,D,Q)_m\)</span>, onde <span class="math inline">\(m\)</span> é o período sazonal e os termos da parte sazonal do modelo são denotados por letras maiúsculas. Um modelo <span class="math inline">\(ARIMA(1,1,1)(1,1,1)_{12}\)</span> é para sazonalidade anual e pode ser escrito em notação de defasagem conforme segue, onde <span class="math inline">\(\Phi\)</span> e <span class="math inline">\(\Theta\)</span> são, respectivamente, os termos autorregressivos e de média móvel, ambos de primeira ordem, para a parte sazonal. Os modelos ARIMA sazonais são comumente chamados de SARIMA.</p>
<p><span class="math display">\[
(1-\phi_1B)(1-\Phi_1B^{12})(1-B)(1-B^{12})y_t = c+( 1+\theta_1B)( 1+\Theta_1B^{12})\varepsilon_t
\]</span></p>
<p>A <a href="#fig-passbr-dif12" class="quarto-xref">Figura&nbsp;<span>6.18</span></a> expõe a variação sazonal da sériede log(passageiros) em vôos do Brasil, além dos correlogramas de ACF e PACF. Pode-se observar que a série sazonalmente diferenciada ainda apresenta alta tendência. É ainda necessário uma diferenciação de primeira ordem.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-passbr-dif12" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-passbr-dif12-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="ST6_files/figure-html/fig-passbr-dif12-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-passbr-dif12-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;6.18: Variação sazonal no log(passageiros) de vôos no Brasil
</figcaption>
</figure>
</div>
</div>
</div>
<p>A <a href="#fig-passbr-dif12-1" class="quarto-xref">Figura&nbsp;<span>6.19</span></a> apresenta a série mais uma vez diferenciada. Examinando-se o correlograma de ACF, pode-se sugerir um modelo MA(1) para a parte não sazonal, dada a significância no lag 1, e um modelo MA(1) para a parte sazonal, dada a significância no lag 12. Logo, pode-se sugerir um modelo <span class="math inline">\(ARIMA(0,1,1)(0,1,1)_{12}\)</span>. Ao observar o correlograma de PACF, há indícios de que um modelo autorregressivo de ordem AR(1) seja adequado para a parte não sazonal, enquanto um modelo AR(3) pode ser interessante para a parte sazonal, devido aos picos de 12, 24 e 26 meses. Entretanto, ao se tentar estimar um modelo <span class="math inline">\(ARIMA(1,1,0)(3,1,0)_{12}\)</span> não foram reportados resultados, sendo então aproximado um modelo <span class="math inline">\(ARIMA(1,1,0)(2,1,0)_{12}\)</span>.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-passbr-dif12-1" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-passbr-dif12-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="ST6_files/figure-html/fig-passbr-dif12-1-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-passbr-dif12-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;6.19: Série de passageiros de vôos no Brasil
</figcaption>
</figure>
</div>
</div>
</div>
<p>Além dos modelos sugeridos, o método automático do pacote <code>fable</code> sugere um modelo de ordem <span class="math inline">\(ARIMA(1,1,1)(0,1,1)_{12}\)</span>, conforme <a href="#tbl-arima_" class="quarto-xref">Tabela&nbsp;<span>6.5</span></a>, muito próximo dos considerados inicialmente.</p>
<div class="cell">
<div id="tbl-arima_" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-arima_-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Tabela&nbsp;6.5: Modelos ARIMA testados para a série log(passageiros)
</figcaption>
<div aria-describedby="tbl-arima_-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">Modelo</th>
<th style="text-align: left;">Ordem</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">arima011011</td>
<td style="text-align: left;">&lt;ARIMA(0,1,1)(0,1,1)[12]&gt;</td>
</tr>
<tr class="even">
<td style="text-align: left;">arima110210</td>
<td style="text-align: left;">&lt;ARIMA(1,1,0)(2,1,0)[12]&gt;</td>
</tr>
<tr class="odd">
<td style="text-align: left;">auto</td>
<td style="text-align: left;">&lt;ARIMA(1,1,1)(0,1,1)[12]&gt;</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
<p>A <a href="#tbl-arima_res" class="quarto-xref">Tabela&nbsp;<span>6.6</span></a> resume o resultado dos três modelos. Considerando o AICc, o modelo automático apresentou por pouco o melhor resultado.</p>
<div class="cell">
<div id="tbl-arima_res" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-arima_res-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Tabela&nbsp;6.6: Resultados dos modelos ARIMA testados para a série log(passageiros)
</figcaption>
<div aria-describedby="tbl-arima_res-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">.model</th>
<th style="text-align: right;">sigma2</th>
<th style="text-align: right;">log_lik</th>
<th style="text-align: right;">AIC</th>
<th style="text-align: right;">AICc</th>
<th style="text-align: right;">BIC</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">auto</td>
<td style="text-align: right;">0.0010447</td>
<td style="text-align: right;">455.1001</td>
<td style="text-align: right;">-902.2002</td>
<td style="text-align: right;">-902.0201</td>
<td style="text-align: right;">-888.5004</td>
</tr>
<tr class="even">
<td style="text-align: left;">arima011011</td>
<td style="text-align: right;">0.0010532</td>
<td style="text-align: right;">453.7601</td>
<td style="text-align: right;">-901.5202</td>
<td style="text-align: right;">-901.4126</td>
<td style="text-align: right;">-891.2453</td>
</tr>
<tr class="odd">
<td style="text-align: left;">arima110210</td>
<td style="text-align: right;">0.0011762</td>
<td style="text-align: right;">444.0289</td>
<td style="text-align: right;">-880.0578</td>
<td style="text-align: right;">-879.8776</td>
<td style="text-align: right;">-866.3580</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
<p>A seguir são apresentados os coeficientes do modelo <span class="math inline">\(ARIMA(1,1,1)(0,1,1)_{12}\)</span>.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Series: Passageiros 
Model: ARIMA(1,1,1)(0,1,1)[12] 
Transformation: log(Passageiros) 

Coefficients:
         ar1      ma1     sma1
      0.5214  -0.6437  -0.7410
s.e.  0.2121   0.1859   0.0584

sigma^2 estimated as 0.001045:  log likelihood=455.1
AIC=-902.2   AICc=-902.02   BIC=-888.5</code></pre>
</div>
</div>
<p>A <a href="#fig-passbr-res" class="quarto-xref">Figura&nbsp;<span>6.20</span></a> apresenta os gráficos de resíduos do modelo <span class="math inline">\(ARIMA(1,1,1)(0,1,1)_{12}\)</span>. A série residual apresenta padrão estacionário e não há indícios de desvio de normalidade pelo histograma. Há significância na autocorrelação para defasagem de 11, 13 e 22 observações.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-passbr-res" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-passbr-res-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="ST6_files/figure-html/fig-passbr-res-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-passbr-res-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;6.20: Série de passageiros de vôos no Brasil
</figcaption>
</figure>
</div>
</div>
</div>
<p>A <a href="#tbl-lb_auto" class="quarto-xref">Tabela&nbsp;<span>6.7</span></a> apresenta o resultado do teste de Ljung-Box para os resíduos do modelo <span class="math inline">\(ARIMA(1,1,1)(0,1,1)_{12}\)</span> para a série log(passageiros). No caso sazonal, considera-se <span class="math inline">\(K=p+q+P+Q\)</span> graus de liberdade no teste. Considerando um nível de significância de 0,05, não há indícios suficientes para rejeição da hipótese nula de ausência de autocorrelação residual.</p>
<div class="cell">
<div id="tbl-lb_auto" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-lb_auto-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Tabela&nbsp;6.7: Teste Ljung-Box para o modelo ARIMA(1,1,1)(0,1,1)12 para a série log(passageiros)
</figcaption>
<div aria-describedby="tbl-lb_auto-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">.model</th>
<th style="text-align: right;">lb_stat</th>
<th style="text-align: right;">lb_pvalue</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">auto</td>
<td style="text-align: right;">28.77407</td>
<td style="text-align: right;">0.1195322</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
<p>A <a href="#fig-passbr-for" class="quarto-xref">Figura&nbsp;<span>6.21</span></a> apresenta a previsão para 3 anos à frente para a série de passageiros em vôos do Brasil. Sabe-se que a pandemia reduziu o volume de vôos para níveis menores que os dos anos 2000. Entretanto, o modelo capturou bem a tendência dos últimos anos e o padrão de sazonalidade no número de passageiros. Após alguns anos de observação pós-pandemia, modelos ARIMA seguirão sendo úteis para modelar a variação observada em volume de passageiros em vôos do Brasil.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-passbr-for" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-passbr-for-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="ST6_files/figure-html/fig-passbr-for-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-passbr-for-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;6.21: Previsão para 3 anos à frente para a série de passageiros de vôos no Brasil
</figcaption>
</figure>
</div>
</div>
</div>
<p>A <a href="#fig-prodndur" class="quarto-xref">Figura&nbsp;<span>6.22</span></a> expõe a série de produtos não duráveis no Brasil. Observa-se padrão sazonal anual com tendência de crescimento até 2015 e depois de queda, com pior resultado em 2020, devido a pandemia. Após, 2021 observa-se tendência de recuperação.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-prodndur" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-prodndur-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="ST6_files/figure-html/fig-prodndur-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-prodndur-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;6.22: Produção mensal de bens não duráveis no Brasil
</figcaption>
</figure>
</div>
</div>
</div>
<p>A <a href="#fig-ndur_diff12" class="quarto-xref">Figura&nbsp;<span>6.23</span></a> expõe a série de variação sazonal de bens de consumo não duráveis, considerando os dados de até dezembro de 2021. Pode-se sugerir pelo correlograma de PACF um modelo de ordem (3,1,0) para a parte não sazonal e um modelo de ordem (2,0,0) para a parte sazonal, dado o pico nos atrasos de 12 e 24 meses.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-ndur_diff12" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-ndur_diff12-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="ST6_files/figure-html/fig-ndur_diff12-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-ndur_diff12-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;6.23: Variação sazonal na produção de bens de consumo não duráveis
</figcaption>
</figure>
</div>
</div>
</div>
<p>A <a href="#tbl-arima_ndur" class="quarto-xref">Tabela&nbsp;<span>6.8</span></a> expõe os modelos testados manualmente e o selecionado automaticamente.</p>
<div class="cell">
<div id="tbl-arima_ndur" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-arima_ndur-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Tabela&nbsp;6.8: Modelos ARIMA testados para a série de bens não duráveis
</figcaption>
<div aria-describedby="tbl-arima_ndur-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">name</th>
<th style="text-align: left;">Modelo</th>
<th style="text-align: left;">Ordem</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">nao_duraveis</td>
<td style="text-align: left;">arima310200</td>
<td style="text-align: left;">&lt;ARIMA(3,1,0)(2,0,0)[12] w/ drift&gt;</td>
</tr>
<tr class="even">
<td style="text-align: left;">nao_duraveis</td>
<td style="text-align: left;">auto</td>
<td style="text-align: left;">&lt;ARIMA(4,1,1)(0,1,1)[12]&gt;</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
<p>A <a href="#tbl-arima_ndur_" class="quarto-xref">Tabela&nbsp;<span>6.9</span></a> apresenta os resultados para os modelos testados na série de bens de consumo não duráveis. O modelo <span class="math inline">\(ARIMA(4,1,1)(0,1,1)_{12}\)</span>, selecionado via pacote <code>fable</code> apresenta melhor ajuste. <span class="citation" data-cites="hyndman2008automatic">Hyndman e Khandakar (<a href="references.html#ref-hyndman2008automatic" role="doc-biblioref">2008</a>)</span> descrevem a abordagem usada no pacote para seleção automática de modelos ARIMA sem e com sazonalidade e também para modelos ETS.</p>
<div class="cell">
<div id="tbl-arima_ndur_" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-arima_ndur_-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Tabela&nbsp;6.9: Resultados dos ARIMA testados para a série de bens não duráveis
</figcaption>
<div aria-describedby="tbl-arima_ndur_-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">.model</th>
<th style="text-align: right;">sigma2</th>
<th style="text-align: right;">log_lik</th>
<th style="text-align: right;">AIC</th>
<th style="text-align: right;">AICc</th>
<th style="text-align: right;">BIC</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">auto</td>
<td style="text-align: right;">14.09469</td>
<td style="text-align: right;">-591.4166</td>
<td style="text-align: right;">1196.833</td>
<td style="text-align: right;">1197.374</td>
<td style="text-align: right;">1220.428</td>
</tr>
<tr class="even">
<td style="text-align: left;">arima310200</td>
<td style="text-align: right;">16.65650</td>
<td style="text-align: right;">-649.3569</td>
<td style="text-align: right;">1312.714</td>
<td style="text-align: right;">1313.225</td>
<td style="text-align: right;">1336.688</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
<p>A <a href="#fig-ndur_res" class="quarto-xref">Figura&nbsp;<span>6.24</span></a> apresenta os gráficos residuais para o modelo <span class="math inline">\(ARIMA(4,1,1)(0,1,1)_{12}\)</span> para a série de bens de consumo não duráveis. O valor discrepante março de 2021 é atribuído à pandemia. Observa-se picos de autocorrelação parcial para defasagens próximas de 2 anos. No entanto, pelo teste de Ljung-Box, apresentado na <a href="#tbl-lbox_ndur" class="quarto-xref">Tabela&nbsp;<span>6.10</span></a>, não há indícios suficientes que indicam a rejeição da hipótese de independência dos resíduos.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-ndur_res" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-ndur_res-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="ST6_files/figure-html/fig-ndur_res-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-ndur_res-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;6.24: Resíduos do modelo ARIMA(4,1,1)(0,1,1)12 para série de produção de bens de consumo não duráveis
</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell">
<div id="tbl-lbox_ndur" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-lbox_ndur-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Tabela&nbsp;6.10: Teste de Ljung-Box para os resíduos da série de produção de bens de consumo não duráveis
</figcaption>
<div aria-describedby="tbl-lbox_ndur-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">name</th>
<th style="text-align: left;">.model</th>
<th style="text-align: right;">lb_stat</th>
<th style="text-align: right;">lb_pvalue</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">nao_duraveis</td>
<td style="text-align: left;">auto</td>
<td style="text-align: right;">25.45438</td>
<td style="text-align: right;">0.1129033</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
<p>A <a href="#fig-ndur-for" class="quarto-xref">Figura&nbsp;<span>6.25</span></a> apresenta graficamente os resultados de previsão para além de 2021, juntamente com os dados disponíveis e separados para teste. Observa-se boa proximidade com os dados não considerados para treinamento do modelo. Apesar da queda em 2021 devido à pandemia, o modelo treinado conseguiu apresentar uma boa projeção à curto e médio prazo.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-ndur-for" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-ndur-for-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="ST6_files/figure-html/fig-ndur-for-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-ndur-for-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;6.25: Previsão para 3 anos à frente para a série de bens de consumo não duráveis
</figcaption>
</figure>
</div>
</div>
</div>
<p>A <a href="#tbl-metrics_ndur" class="quarto-xref">Tabela&nbsp;<span>6.11</span></a> finaliza a análise comparando o desempenho dos modelos estimados aplicados aos dados de teste para a série de bens de consumo não duráveis. Confirma-se a superioridade do modelo estimado automaticamente.</p>
<div class="cell">
<div id="tbl-metrics_ndur" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-metrics_ndur-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Tabela&nbsp;6.11: Métricas para comparar o desenho dos modelos testados para a série de bens de consumo não duráveis
</figcaption>
<div aria-describedby="tbl-metrics_ndur-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">.model</th>
<th style="text-align: right;">RMSE</th>
<th style="text-align: right;">MAE</th>
<th style="text-align: right;">MAPE</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">arima310200</td>
<td style="text-align: right;">6.659694</td>
<td style="text-align: right;">5.664403</td>
<td style="text-align: right;">5.710309</td>
</tr>
<tr class="even">
<td style="text-align: left;">auto</td>
<td style="text-align: right;">5.714044</td>
<td style="text-align: right;">4.262668</td>
<td style="text-align: right;">4.127184</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list" style="display: none">
<div id="ref-hyndman2008automatic" class="csl-entry" role="listitem">
Hyndman, Rob J, e Yeasmin Khandakar. 2008. <span>«Automatic time series forecasting: the forecast package for R»</span>. <em>Journal of statistical software</em> 27: 1–22.
</div>
</div>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copiada");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copiada");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./ST5.html" class="pagination-link" aria-label="Suavização exponencial">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Suavização exponencial</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./ST7.html" class="pagination-link" aria-label="Regressão dinâmica">
        <span class="nav-page-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Regressão dinâmica</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>
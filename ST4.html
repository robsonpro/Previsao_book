<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="pt" xml:lang="pt"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Robson Bruno Dutra Pereira">

<title>4&nbsp; Regressão de séries temporais – Séries Temporais e Previsão</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./ST5.html" rel="next">
<link href="./ST3.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-8da5b4427184b79ecddefad3d342027e.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "Nenhum resultado",
    "search-matching-documents-text": "documentos correspondentes",
    "search-copy-link-title": "Copiar link para a busca",
    "search-hide-matches-text": "Esconder correspondências adicionais",
    "search-more-match-text": "mais correspondência neste documento",
    "search-more-matches-text": "mais correspondências neste documento",
    "search-clear-button-title": "Limpar",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancelar",
    "search-submit-button-title": "Enviar",
    "search-label": "Procurar"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Alternar barra lateral" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./ST4.html"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Regressão de séries temporais</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Alternar barra lateral" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Procurar" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Séries Temporais e Previsão</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Procurar"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Prefácio</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ST1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introdução e gráficos</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ST2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Análise descritiva, métodos simples de previsão e diagnóstico</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ST3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Decomposição de séries temporais</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ST4.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Regressão de séries temporais</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ST5.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Suavização exponencial</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ST6.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Modelos auto-regressivos integrados de médias móveis (ARIMA)</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ST7.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Regressão dinâmica</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Referências</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Índice</h2>
   
  <ul>
  <li><a href="#regressão-linear-simples" id="toc-regressão-linear-simples" class="nav-link active" data-scroll-target="#regressão-linear-simples"><span class="header-section-number">4.1</span> Regressão linear simples</a></li>
  <li><a href="#regressão-linear-múltipla" id="toc-regressão-linear-múltipla" class="nav-link" data-scroll-target="#regressão-linear-múltipla"><span class="header-section-number">4.2</span> Regressão linear múltipla</a></li>
  <li><a href="#desempenho-do-modelo-de-regressão" id="toc-desempenho-do-modelo-de-regressão" class="nav-link" data-scroll-target="#desempenho-do-modelo-de-regressão"><span class="header-section-number">4.3</span> Desempenho do modelo de regressão</a></li>
  <li><a href="#diagnóstico-dos-resíduos" id="toc-diagnóstico-dos-resíduos" class="nav-link" data-scroll-target="#diagnóstico-dos-resíduos"><span class="header-section-number">4.4</span> Diagnóstico dos resíduos</a></li>
  <li><a href="#preditores-úteis" id="toc-preditores-úteis" class="nav-link" data-scroll-target="#preditores-úteis"><span class="header-section-number">4.5</span> Preditores úteis</a></li>
  <li><a href="#seleção-de-preditores" id="toc-seleção-de-preditores" class="nav-link" data-scroll-target="#seleção-de-preditores"><span class="header-section-number">4.6</span> Seleção de preditores</a></li>
  <li><a href="#previsão" id="toc-previsão" class="nav-link" data-scroll-target="#previsão"><span class="header-section-number">4.7</span> Previsão</a></li>
  <li><a href="#regressão-não-linear" id="toc-regressão-não-linear" class="nav-link" data-scroll-target="#regressão-não-linear"><span class="header-section-number">4.8</span> Regressão não linear</a></li>
  <li><a href="#implementação-em-r" id="toc-implementação-em-r" class="nav-link" data-scroll-target="#implementação-em-r"><span class="header-section-number">4.9</span> Implementação em R</a></li>
  <li><a href="#exercícios-propostos" id="toc-exercícios-propostos" class="nav-link" data-scroll-target="#exercícios-propostos"><span class="header-section-number">4.10</span> Exercícios propostos</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Regressão de séries temporais</span></h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Autor</div>
    <div class="quarto-title-meta-contents">
             <p>Robson Bruno Dutra Pereira </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="regressão-linear-simples" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="regressão-linear-simples"><span class="header-section-number">4.1</span> Regressão linear simples</h2>
<p>A regressão de séries temporais visa modelar uma série de interesse, dita dependente, em função de outra ou mais séries, referidas como independentes, às quais são supostamente relacionadas. Os métodos mais tradicionais consideram a dependência temporal da própria série para modelagem e previsão. Entretanto, em situações onde há séries relacionadas disponíveis a regressão pode ser útil. Ademais, há possibilidade de combinar a regressão com modelos autoregressivos integrados de m[edias móveis, conforme será abordado no capítulo 7.</p>
<p>Seja um problema onde deseja-se prever uma série temporal contínua, <span class="math inline">\(y_1, y_2, ..., y_T\)</span>, em função de outra, <span class="math inline">\(x_1, x_2, ..., x_T\)</span>.</p>
<p>Na <a href="ST7.html#fig-graos" class="quarto-xref">Figura&nbsp;<span>7.6</span></a> são plotadas as séries temporais anuais de área plantada em hectare e grãos produzidos em toneladas no Brasil de 1977 a 2022, <a href="http://www.ipeadata.gov.br">Ipeadata</a>. As séries apresentam tendência de crescimento não linear com algumas flutuações.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-graos" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-graos-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="ST4_files/figure-html/fig-graos-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-graos-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;4.1: Produção de grãos no Brasil
</figcaption>
</figure>
</div>
</div>
</div>
<p>Ao plotar um diagrama de dispersão entre as séries, pode-se observar uma correlação linear positiva alta entre estas, conforme <a href="#fig-pairs_graos" class="quarto-xref">Figura&nbsp;<span>4.2</span></a>.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-pairs_graos" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-pairs_graos-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="ST4_files/figure-html/fig-pairs_graos-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-pairs_graos-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;4.2: Área plantada versus Produção de grãos
</figcaption>
</figure>
</div>
</div>
</div>
<p>Conforme observado na <a href="#fig-reg_graos" class="quarto-xref">Figura&nbsp;<span>4.3</span></a>, pode-se considerar neste caso e em diversos outros a aproximação de uma função linear para tal relação.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-reg_graos" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-reg_graos-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="ST4_files/figure-html/fig-reg_graos-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-reg_graos-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;4.3: Modelo de regressão linear simples para produção de grãos em função da área plantada
</figcaption>
</figure>
</div>
</div>
</div>
<p>O modelo linear plotado em azul pode ser descrito conforme a <a href="#eq-linreg" class="quarto-xref">Equação&nbsp;<span>4.1</span></a>, onde <span class="math inline">\(\beta_0\)</span> é uma constante e <span class="math inline">\(\beta_1\)</span> é um coeficiente linear.</p>
<p><span id="eq-linreg"><span class="math display">\[
\hat{y}_t = \beta_0+\beta_{1}x_t
\tag{4.1}\]</span></span></p>
<p>As observações da série dependente ou resposta, <span class="math inline">\(y_t\)</span>, podem ser descritas conforme <a href="#eq-obs" class="quarto-xref">Equação&nbsp;<span>4.2</span></a>, como sendo o valor estimado, <span class="math inline">\(\hat y_t\)</span>, adicionado de um termo de erro ou resíduo, <span class="math inline">\(\varepsilon_t\)</span>.</p>
<p><span id="eq-obs"><span class="math display">\[
\begin{aligned}
y_t = \hat{y}_t + \varepsilon_t \\
y_t = \beta_0 + \beta_1x_t + \varepsilon_t \\
\end{aligned}
\tag{4.2}\]</span></span></p>
<p>Considerando as <span class="math inline">\(T\)</span> observações disponíveis das séries, <span class="math inline">\((x_1, y_1), (x_2, y_2), ..., (x_T, y_T)\)</span>, pode-se pensar em um modelo que minimize os erros de previsão. Uma vez que o erro é normalmente distribuído, com média nula e variância <span class="math inline">\(\sigma_\varepsilon^2\)</span>, <span class="math inline">\(\varepsilon \sim N(0,\sigma_\varepsilon^2)\)</span>, pode-se trabalhar a minimização da soma dos quadrados dos erros de previsão, <span class="math inline">\(\sum_{t=1}^{T}\varepsilon_t^2\)</span>. A Figura <a href="#fig-erros_graos" class="quarto-xref">Figura&nbsp;<span>4.4</span></a> plota em linhas vermelhas verticais os resíduos. O modelo plotado minimiza a soma dos quadrados dos erros.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-erros_graos" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-erros_graos-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="ST4_files/figure-html/fig-erros_graos-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-erros_graos-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;4.4: Erros de previsão para o modelo de regressão linear para produção de grãos em função da área plantada
</figcaption>
</figure>
</div>
</div>
</div>
<p>A análise à seguir expõe os coeficientes do modelo estimado com teste t para significância destes. Neste curso não será dada ênfase na inferência, mas na previsão. De forma simples um valor t com alta magnitude ou um p-valor (Pr(&gt;|t|)) baixo indica risco baixo de rejeitar a hipótese nula de ausência de efeito da variável ou série independente (<span class="math inline">\(x_t\)</span>).</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Series: producao 
Model: TSLM 

Residuals:
   Min     1Q Median     3Q    Max 
-40729 -18733   1072  18188  35065 

Coefficients:
                Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)   -1,726e+05  1,248e+04  -13,84   &lt;2e-16 ***
area_plantada  6,285e+00  2,561e-01   24,54   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0,001 '**' 0,01 '*' 0,05 '.' 0,1 ' ' 1

Residual standard error: 21080 on 46 degrees of freedom
Multiple R-squared: 0,929,  Adjusted R-squared: 0,9275
F-statistic: 602,2 on 1 and 46 DF, p-value: &lt; 2,22e-16</code></pre>
</div>
</div>
<p>O modelo para prever a produção de grãos, <span class="math inline">\(y_t\)</span>, em função da área plantada, <span class="math inline">\(x_t\)</span>, fica:</p>
<p><span class="math display">\[
\hat{y}_t = -1,726 \times 10^{5} + 6,285x_t
\]</span></p>
</section>
<section id="regressão-linear-múltipla" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="regressão-linear-múltipla"><span class="header-section-number">4.2</span> Regressão linear múltipla</h2>
<p>No caso de onde há múltiplas séries exógenas ou regressoras de interesse, <span class="math inline">\(x_{t1}, x_{t2}, ..., x_{tk}\)</span>, onde <span class="math inline">\(k\)</span> é o número de séries consideradas para estimar <span class="math inline">\(y_t\)</span>, pode-se considerar o modelo com um coeficiente linear associado a cada variável, conforme <a href="#eq-lnm" class="quarto-xref">Equação&nbsp;<span>4.3</span></a>.</p>
<p><span id="eq-lnm"><span class="math display">\[
\hat{y}_t = \beta_0 + \beta_1x_{t1} + \beta_2x_{t2} + \cdots + \beta_kx_{tk} = \beta_0 + \sum_{j=1}^{k}\beta_jx_{tj},  
\tag{4.3}\]</span></span></p>
<p>ou de forma matricial segundo <a href="#eq-lnmm" class="quarto-xref">Equação&nbsp;<span>4.4</span></a>, com <span class="math inline">\(\mathbf{X}_{[T\times (k+1)]}\)</span> e <span class="math inline">\(\mathbf{\beta}_{[(k+1) \times 1]}\)</span>:</p>
<p><span id="eq-lnmm"><span class="math display">\[
\begin{aligned}
\hat{\mathbf{y}} = \mathbf{X}\mathbf{\beta}
\end{aligned},
\tag{4.4}\]</span></span></p>
<p>onde a matrix <span class="math inline">\(\mathbf{X}\)</span> contém uma coluna unitária para a constante e uma coluna para cada série independente:</p>
<p><span class="math display">\[
\mathbf{X} =
\begin{bmatrix}
1 &amp; x_{11} &amp; x_{12} &amp; \cdots &amp; x_{1k}\\
1 &amp; x_{21} &amp; x_{22} &amp; \cdots &amp; x_{2k} \\
\vdots &amp; \vdots &amp; \vdots &amp; \ddots &amp; \vdots\\
1 &amp; x_{T1} &amp; x_{T2} &amp; \cdots &amp; x_{Tk} \\
\end{bmatrix}, e\\
\]</span></p>
<p>e <span class="math inline">\(\beta\)</span> consiste no vetor de coeficientes:</p>
<p><span class="math display">\[
\mathbf{\beta}^T =
\begin{bmatrix}
\beta_0 &amp; \beta_1 &amp; \cdots &amp; \beta_k\\
\end{bmatrix}. \\
\]</span></p>
<p>Os valores observados da série <span class="math inline">\(\mathbf{y}\)</span> podem ser recuperados somando os valores preditos e o erro, conforme <a href="#eq-obsm" class="quarto-xref">Equação&nbsp;<span>4.5</span></a>.</p>
<p><span id="eq-obsm"><span class="math display">\[
\begin{aligned}
\mathbf{y} = \mathbf{X}\mathbf{\beta} + \mathbf{\varepsilon}
\end{aligned}
\tag{4.5}\]</span></span></p>
<p>Tomando tal notação, a soma dos quadrados dos erros pode ser descrita como <span class="math inline">\(\sum_{t=1}^{T}\varepsilon_t^2 = \mathbf{\varepsilon}^T\mathbf{\varepsilon}\)</span>. Desenvolvendo tal expressão tem-se:</p>
<p><span class="math display">\[
\begin{aligned}
L(\mathbf{\beta}) = \mathbf{\varepsilon}^T\mathbf{\varepsilon} = (\mathbf{y} - \mathbf{X}\mathbf{\beta})^T(\mathbf{y} - \mathbf{X}\mathbf{\beta}) \\
\mathbf{y}^T\mathbf{y} - 2\mathbf{\beta}^T\mathbf{X}^T\mathbf{y} + \mathbf{\beta}^T\mathbf{X}^T\mathbf{X}\mathbf{\beta}
\end{aligned}
\]</span></p>
<p>Para minimizar <span class="math inline">\(L\)</span> em relação à estimativa de <span class="math inline">\(\mathbf{\beta}\)</span>, pode-se diferenciar tal quantidade em relação à <span class="math inline">\(\mathbf{\beta}\)</span> e igualar a zero:</p>
<p><span class="math display">\[
\begin{aligned}
\frac{\partial L}{\partial \mathbf{\beta}} = -2\mathbf{X}^T\mathbf{y} + 2\mathbf{X}^T\mathbf{X}\mathbf{\beta} = 0 \\
\end{aligned}
\]</span></p>
<p>As estimativas dos coeficientes <span class="math inline">\(\hat\beta\)</span> obtidas segundo a <a href="#eq-ols" class="quarto-xref">Equação&nbsp;<span>4.6</span></a> minimizam a soma dos quadrados dos resíduos, <span class="math inline">\(\sum \varepsilon_i^2\)</span>, sendo, portanto, as estimativas de mínimos quadrados.</p>
<p><span id="eq-ols"><span class="math display">\[
\hat{\mathbf{\beta}} = (\mathbf{X}^T\mathbf{X})^{-1}(\mathbf{X}^T\mathbf{y})
\tag{4.6}\]</span></span></p>
<p>Seja a série multivariada de exportação, importação, produção e vendas de fertilizantes no Brasil, plotada na <a href="#fig-fert" class="quarto-xref">Figura&nbsp;<span>4.5</span></a>, disponível em <a href="http://www.ipeadata.gov.br">Ipeadata</a>. A série tem frequência mensal e possui dados a partir de 1998, exceto para a de exportação, disponível a partir de 2013. Observa-se um volume muito maior de importações que produção e exportações, além de sazonalidade. As séries de importação e vendas apresentam padrão de crescimento.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-fert" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-fert-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="ST4_files/figure-html/fig-fert-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-fert-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;4.5: Fertilizantes no Brasil
</figcaption>
</figure>
</div>
</div>
</div>
<p>Observa-se na <a href="#fig-fert_pairs" class="quarto-xref">Figura&nbsp;<span>4.6</span></a> diagramas de dispersão e correlações aos pares para os dados a partir de 2013. Há correlação positiva mais significativa entre as séries de vendas e importação. A partir de 2013, a queda na produção é acompanhada do aumento nas importações, o que justifica a correlação negativa.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-fert_pairs" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-fert_pairs-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="ST4_files/figure-html/fig-fert_pairs-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-fert_pairs-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;4.6: Correlação entre as séries de fertilizantes
</figcaption>
</figure>
</div>
</div>
</div>
<p>Seja um modelo de regressão para prever a venda de fertilizantes em função das outras séries a partir de 2013. A seguir apresenta-se tal modelo. Apenas a série de exportações não foi significativa.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Series: vendas 
Model: TSLM 

Residuals:
     Min       1Q   Median       3Q      Max 
-1342150  -397913    32404   402134  1619150 

Coefficients:
              Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) -8,085e+05  4,687e+05  -1,725  0,08690 .  
producao     1,872e+00  5,821e-01   3,215  0,00165 ** 
importacao   1,099e+00  7,735e-02  14,210  &lt; 2e-16 ***
exportacao  -5,323e-01  2,742e+00  -0,194  0,84640    
---
Signif. codes:  0 '***' 0,001 '**' 0,01 '*' 0,05 '.' 0,1 ' ' 1

Residual standard error: 585300 on 128 degrees of freedom
Multiple R-squared: 0,6446, Adjusted R-squared: 0,6363
F-statistic: 77,39 on 3 and 128 DF, p-value: &lt; 2,22e-16</code></pre>
</div>
</div>
<p>O modelo obtido pode ser escrito conforme <a href="#eq-regfert" class="quarto-xref">Equação&nbsp;<span>4.7</span></a>, onde <span class="math inline">\(\hat y_t\)</span> consiste na estimativa de vendas n período <span class="math inline">\(t\)</span>, <span class="math inline">\(x_{t1}\)</span> consiste no volume produzido, <span class="math inline">\(x_{t2}\)</span> no volume importado e <span class="math inline">\(x_{t3}\)</span> no volume exportado no período <span class="math inline">\(t\)</span>.</p>
<p><span id="eq-regfert"><span class="math display">\[
\hat y_t = -8,08\times10^5 + 1,87x_{t1} + 1,10x_{t2} -5,32x_{t3}
\tag{4.7}\]</span></span></p>
</section>
<section id="desempenho-do-modelo-de-regressão" class="level2" data-number="4.3">
<h2 data-number="4.3" class="anchored" data-anchor-id="desempenho-do-modelo-de-regressão"><span class="header-section-number">4.3</span> Desempenho do modelo de regressão</h2>
<p>Uma forma de medir o ajuste do modelo obtido aos dados seria a partir do cálculo do coeficiente de determinação múltipla, <span class="math inline">\(R^2\)</span>, conforme a <a href="#eq-r2" class="quarto-xref">Equação&nbsp;<span>4.8</span></a>,</p>
<p><span id="eq-r2"><span class="math display">\[
\begin{align}
R^2 &amp;= 1- SS_{E}/SS_T \\
R^2 &amp;= 1- \frac{\sum_{t=1}^{T}(y_t-\hat{y}_t)^2}{\sum_{i=t}^{T}(y_y-\overline{y})^2} = 1- \frac{\sum_{t=1}^{T}\varepsilon_t^2}{\sum_{i=t}^{T}(y_y-\overline{y})^2},
\end{align}
\tag{4.8}\]</span></span></p>
<p>onde <span class="math inline">\(SS_E\)</span> consiste na soma dos quadrados dos erros e <span class="math inline">\(SS_T\)</span> consiste na soma dos quadrados total, ou no numerador da variância da série a ser predita.</p>
<p>O <span class="math inline">\(R^2\)</span> sempre aumenta ao se adicionar novos termos no modelo, mesmo se estes não são significativos, uma vez que não leva em conta os graus de liberdade no cálculo. O coeficiente de determinação múltipla ajustado, <span class="math inline">\(R^2_{aj}\)</span>, é uma métrica mais interessante, já que considera as médias dos quadrados ao invés das somas dos quadrados dos erros, conforme a <a href="#eq-r2aj" class="quarto-xref">Equação&nbsp;<span>4.9</span></a>.</p>
<p><span id="eq-r2aj"><span class="math display">\[
\begin{align}
R^2_{aj} &amp;= 1- MS_{E}/MS_T \\
R^2_{aj} &amp;= 1- \frac{\sum_{t=1}^{T}(y_t-\hat{y}_t)^2/(T-K-1)}{\sum_{t=1}^{T}(y_t-\overline{y})^2/(T-1)},
\end{align}
\tag{4.9}\]</span></span></p>
<p>onde <span class="math inline">\(K\)</span> é o número de termos no modelo, <span class="math inline">\(MS_E\)</span> consiste média dos quadrados dos erros, que consiste na estimativa de variância dos resíduos, enquanto <span class="math inline">\(MS_T\)</span> consiste na média dos quadrados total, ou na variância da série a ser predita.</p>
<p>Para o modelo de regressão simples para produção de grãos em função da área plantada foi obtido um ajuste de mais de 91%, garantindo tal percentual de explicação da variabilidade da série de produção em função da área plantada. A <a href="#fig-graos_fit" class="quarto-xref">Figura&nbsp;<span>4.7</span></a> plota a série de produção de grãos observada e a aproximada pelo modelo de regressão.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-graos_fit" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-graos_fit-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="ST4_files/figure-html/fig-graos_fit-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-graos_fit-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;4.7: Produção de grãos
</figcaption>
</figure>
</div>
</div>
</div>
<p>A <a href="#fig-fert_fit" class="quarto-xref">Figura&nbsp;<span>4.8</span></a> plota a série de vendas de fertilizantes observada e a aproximada pelo modelo de regressão múltipla.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-fert_fit" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-fert_fit-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="ST4_files/figure-html/fig-fert_fit-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-fert_fit-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;4.8: Vendas de fertilizantes
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="diagnóstico-dos-resíduos" class="level2" data-number="4.4">
<h2 data-number="4.4" class="anchored" data-anchor-id="diagnóstico-dos-resíduos"><span class="header-section-number">4.4</span> Diagnóstico dos resíduos</h2>
<p>A <a href="#fig-graos_resi" class="quarto-xref">Figura&nbsp;<span>4.9</span></a> apresenta alguns gráficos dos resíduos do modelo de produção de grãos em função da área plantada. Pode-se observar que o primeiro gráfico apresenta tendências em alguns instantes, com padrão não aleatório, indicando presença de autocorrelação. O correlograma confirma presença de autocorrelação nos resíduos até a defasagem de 5 observações. Logo, há informação importante não capturada pelo modelo de regressão.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-graos_resi" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-graos_resi-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="ST4_files/figure-html/fig-graos_resi-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-graos_resi-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;4.9: Resíduos do modelo de produão de grãos em função da área plantada
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="preditores-úteis" class="level2" data-number="4.5">
<h2 data-number="4.5" class="anchored" data-anchor-id="preditores-úteis"><span class="header-section-number">4.5</span> Preditores úteis</h2>
<p>Muitas séries temporais costumam apresentar tendência linear. Um modelo linear simples pode considerar o tempo, <span class="math inline">\(t\)</span>, como preditor, de forma a modelar a tendência, conforme <a href="#eq-linmodt" class="quarto-xref">Equação&nbsp;<span>4.10</span></a>.</p>
<p><span id="eq-linmodt"><span class="math display">\[
\hat{y}_t = \beta_0+\beta_{1}t
\tag{4.10}\]</span></span></p>
<p>Pode-se também considerar variáveis dicotômicas ou binárias (<em>dummy</em>) para considerar a sazonalidade, feriados, ou algum evento especial. Por exemplo, para sazonalidade anual com uma série de frequência quadrimestral, pode-se considerar como variávis <em>dummy</em> as expostas na Tabela <a href="#tbl-dummy" class="quarto-xref">Tabela&nbsp;<span>4.1</span></a>, com o modelo descrito na <a href="#eq-linmoddumm" class="quarto-xref">Equação&nbsp;<span>4.11</span></a>. É importante observar que não é necessária a inclusão de todas variáveis dicotômicas no modelo, uma vez que se <span class="math inline">\(d_{2,t}=d_{3,t}=d_{4,t}=0\)</span>, então <span class="math inline">\(d_{1,t}=1\)</span>.</p>
<div id="tbl-dummy" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-dummy-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Tabela&nbsp;4.1: Criação de variáveis dummy
</figcaption>
<div aria-describedby="tbl-dummy-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<thead>
<tr class="header">
<th>Quadrimestre</th>
<th><span class="math inline">\(d_{1,t}\)</span></th>
<th><span class="math inline">\(d_{2,t}\)</span></th>
<th><span class="math inline">\(d_{3,t}\)</span></th>
<th><span class="math inline">\(d_{4,t}\)</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Q1</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td>Q2</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td>Q3</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
</tr>
<tr class="even">
<td>Q4</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
<tr class="odd">
<td>Q1</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td><span class="math inline">\(\vdots\)</span></td>
<td><span class="math inline">\(\vdots\)</span></td>
<td><span class="math inline">\(\vdots\)</span></td>
<td><span class="math inline">\(\vdots\)</span></td>
<td><span class="math inline">\(\vdots\)</span></td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
<p>A Equação <a href="#eq-linmoddumm" class="quarto-xref">Equação&nbsp;<span>4.11</span></a> expõe o modelo de regressão com tais variáveis além do termo de tendência.</p>
<p><span id="eq-linmoddumm"><span class="math display">\[
\hat{y}_t = \beta_0+\beta_{1}t + \beta_2d_{2,t} + \beta_3d_{3,t} + \beta_4d_{4,t}
\tag{4.11}\]</span></span></p>
<p>A <a href="#fig-temp_sjdr" class="quarto-xref">Figura&nbsp;<span>4.10</span></a> exibe a série temporal de temperatura de São João del-Rei para os dias 15 a 28 de junho com frequência horária.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-temp_sjdr" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-temp_sjdr-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="ST4_files/figure-html/fig-temp_sjdr-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-temp_sjdr-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;4.10: Temperatura em São João del-Rei nas duas últimas semanas de junho
</figcaption>
</figure>
</div>
</div>
</div>
<p>A <a href="#fig-season_temp" class="quarto-xref">Figura&nbsp;<span>4.11</span></a> expõe o gráfico sazonal da mesma série. Observa-se sazonalidade diária e uma tendência de crescimento, especialmente da temperatura mínima, para os dias considerados.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-season_temp" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-season_temp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="ST4_files/figure-html/fig-season_temp-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-season_temp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;4.11: Gráfico sazonal da temperatura em São João del-Rei
</figcaption>
</figure>
</div>
</div>
</div>
<p>Um modelo de regressão considerando a tendência e sazonalidade para este caso deve considerar como variáveis <em>dummy</em> o dia, de forma a capturar a variação hora a hora. Logo, neste caso, 24 variáveis dummy são criadas. Observa-se que além da tendência a maior parte de tais variáveis apresenta significância e o modelo contempla mais de 95% de variabilidade da série.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Series: Temperatura 
Model: TSLM 

Residuals:
     Min       1Q   Median       3Q      Max 
-3,20212 -0,76300 -0,08292  0,87326  2,92845 

Coefficients:
                Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)    1,953e+01  3,454e-01  56,556  &lt; 2e-16 ***
trend()        8,882e-03  6,822e-04  13,020  &lt; 2e-16 ***
season()day2  -1,580e+00  4,573e-01  -3,456 0,000624 ***
season()day3  -3,053e+00  4,573e-01  -6,678 1,12e-10 ***
season()day4  -4,528e+00  4,575e-01  -9,897  &lt; 2e-16 ***
season()day5  -5,372e+00  4,575e-01 -11,744  &lt; 2e-16 ***
season()day6  -6,074e+00  4,574e-01 -13,278  &lt; 2e-16 ***
season()day7  -6,933e+00  4,574e-01 -15,157  &lt; 2e-16 ***
season()day8  -7,863e+00  4,574e-01 -17,191  &lt; 2e-16 ***
season()day9  -8,579e+00  4,574e-01 -18,757  &lt; 2e-16 ***
season()day10 -9,095e+00  4,574e-01 -19,886  &lt; 2e-16 ***
season()day11 -9,726e+00  4,574e-01 -21,265  &lt; 2e-16 ***
season()day12 -1,016e+01  4,573e-01 -22,206  &lt; 2e-16 ***
season()day13 -1,074e+01  4,573e-01 -23,491  &lt; 2e-16 ***
season()day14 -1,095e+01  4,573e-01 -23,949  &lt; 2e-16 ***
season()day15 -9,840e+00  4,573e-01 -21,517  &lt; 2e-16 ***
season()day16 -6,699e+00  4,573e-01 -14,648  &lt; 2e-16 ***
season()day17 -1,900e+00  4,573e-01  -4,156 4,20e-05 ***
season()day18  2,148e+00  4,573e-01   4,697 3,97e-06 ***
season()day19  3,775e+00  4,573e-01   8,255 4,39e-15 ***
season()day20  4,637e+00  4,573e-01  10,141  &lt; 2e-16 ***
season()day21  5,221e+00  4,573e-01  11,418  &lt; 2e-16 ***
season()day22  5,298e+00  4,573e-01  11,586  &lt; 2e-16 ***
season()day23  4,461e+00  4,573e-01   9,755  &lt; 2e-16 ***
season()day24  3,252e+00  4,573e-01   7,111 7,93e-12 ***
---
Signif. codes:  0 '***' 0,001 '**' 0,01 '*' 0,05 '.' 0,1 ' ' 1

Residual standard error: 1,21 on 311 degrees of freedom
Multiple R-squared: 0,961,  Adjusted R-squared: 0,958
F-statistic: 319,5 on 24 and 311 DF, p-value: &lt; 2,22e-16</code></pre>
</div>
</div>
<p>Há uma tendência de aumento da temperatura nos dias considerados de 0,00888 °C por hora, ou 0,213°C por dia. Cada coeficiente das variáveis <em>dummy</em> expõe a diferença da respectiva hora em relação à primeira hora do dia. Por exemplo, às 6 da manhã a diferença de temperatura em relação a 1 da manhã é igual a -4.05°C. A Figura <a href="#fig-temp_pred" class="quarto-xref">Figura&nbsp;<span>4.12</span></a> apresenta a série observada e a prevista pelo modelo de regressão.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-temp_pred" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-temp_pred-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="ST4_files/figure-html/fig-temp_pred-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-temp_pred-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;4.12: Temperatura em São João del-Rei
</figcaption>
</figure>
</div>
</div>
</div>
<p>A <a href="#fig-temp_obs_pred" class="quarto-xref">Figura&nbsp;<span>4.13</span></a> apresenta os valores previstos e observados plotados com as horas do dia separadas em cores distintas. Observa-se o excelente ajuste do modelo e a variação da temperatura segundo hora do dia.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-temp_obs_pred" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-temp_obs_pred-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="ST4_files/figure-html/fig-temp_obs_pred-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-temp_obs_pred-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;4.13: Temperatura em São João del-Rei
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="seleção-de-preditores" class="level2" data-number="4.6">
<h2 data-number="4.6" class="anchored" data-anchor-id="seleção-de-preditores"><span class="header-section-number">4.6</span> Seleção de preditores</h2>
<p>A <a href="#fig-petro_serie" class="quarto-xref">Figura&nbsp;<span>4.14</span></a> exibe séries temporais de petróleo refinado e derivados produzidos no Brasil em <span class="math inline">\(m^3\)</span>, <a href="https://www.gov.br/anp/pt-br/centrais-de-conteudo/dados-estatisticos">Dados estatísticos - Agência nacional de petróleo</a>. O petróleo considera o volume nacional e importado.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-petro_serie" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-petro_serie-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="ST4_files/figure-html/fig-petro_serie-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-petro_serie-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;4.14: Petróleo refinado e produção de derivados
</figcaption>
</figure>
</div>
</div>
</div>
<p>A <a href="#fig-corr_petro" class="quarto-xref">Figura&nbsp;<span>4.15</span></a> expõe um gráfico de correlação entre tais séries. As séries foram agrupadas segundo a magnitude e sinal das correlações. A série de petróleo refinado tem correlação positiva com asfalto, oléo diesel, outros não energéticos, querosene de avião, coque e gasolina e correlação negativa ou desprezível com as demais séries.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-corr_petro" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-corr_petro-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="ST4_files/figure-html/fig-corr_petro-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-corr_petro-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;4.15: Correlação entre petróleo refinado e derivados
</figcaption>
</figure>
</div>
</div>
</div>
<p>A seguir expõe-se um modelo de regressão múltipla do petróleo refinado em função do volume produzido dos derivados. Apenas GLP, coque, parafina e solvente não apresentaram significância estatística a 0,05 de significância.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Series: petroleo 
Model: TSLM 

Residuals:
    Min      1Q  Median      3Q     Max 
-728213 -101803   13923  108790  409621 

Coefficients:
                        Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)            4,781e+05  1,720e+05   2,780 0,005800 ** 
GLP                    4,487e-01  2,633e-01   1,704 0,089439 .  
asfalto                1,044e+00  2,804e-01   3,724 0,000237 ***
coque                  5,506e-01  3,585e-01   1,536 0,125750    
gasolina               4,264e-01  9,076e-02   4,698 4,11e-06 ***
lubrificante           3,463e+00  1,037e+00   3,339 0,000954 ***
nafta                  1,001e+00  1,421e-01   7,048 1,39e-11 ***
oleo_combustivel       9,055e-01  7,052e-02  12,841  &lt; 2e-16 ***
oleo_diesel            1,138e+00  5,430e-02  20,960  &lt; 2e-16 ***
outros_nao_energeticos 1,497e+00  2,916e-01   5,133 5,31e-07 ***
parafina               6,667e+00  3,943e+00   1,691 0,091924 .  
querosene_aviao        1,409e+00  1,712e-01   8,230 6,99e-15 ***
querosene_iluminante   8,834e+00  2,943e+00   3,001 0,002929 ** 
solvente               1,358e+00  9,322e-01   1,456 0,146383    
---
Signif. codes:  0 '***' 0,001 '**' 0,01 '*' 0,05 '.' 0,1 ' ' 1

Residual standard error: 176300 on 282 degrees of freedom
Multiple R-squared: 0,9503, Adjusted R-squared: 0,948
F-statistic: 414,9 on 13 and 282 DF, p-value: &lt; 2,22e-16</code></pre>
</div>
</div>
<p>A seguir expõe-se um modelo de regressão múltipla excluindo os termos não significativos do modelo inicial. O modelo apresentou melhora no ajuste, com <span class="math inline">\(R^2_{aj} = 0,9558\)</span>.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Series: petroleo 
Model: TSLM 

Residuals:
    Min      1Q  Median      3Q     Max 
-657756  -91477    9494   92705  484690 

Coefficients:
                         Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)             1,763e+06  1,956e+05   9,010  &lt; 2e-16 ***
asfalto                 9,308e-01  2,470e-01   3,768 0,000200 ***
gasolina                5,786e-01  7,556e-02   7,658 2,96e-13 ***
lubrificante            1,541e+00  9,571e-01   1,610 0,108587    
nafta                   6,184e-01  1,180e-01   5,238 3,15e-07 ***
oleo_combustivel        1,057e+00  6,619e-02  15,975  &lt; 2e-16 ***
oleo_diesel             1,221e+00  3,998e-02  30,550  &lt; 2e-16 ***
outros_nao_energeticos  9,912e-01  2,634e-01   3,763 0,000204 ***
querosene_aviao         1,546e+00  1,537e-01  10,058  &lt; 2e-16 ***
querosene_iluminante   -1,690e+00  2,792e+00  -0,605 0,545491    
data                   -6,809e+01  8,892e+00  -7,658 2,96e-13 ***
---
Signif. codes:  0 '***' 0,001 '**' 0,01 '*' 0,05 '.' 0,1 ' ' 1

Residual standard error: 162500 on 285 degrees of freedom
Multiple R-squared: 0,9573, Adjusted R-squared: 0,9558
F-statistic: 639,7 on 10 and 285 DF, p-value: &lt; 2,22e-16</code></pre>
</div>
</div>
<p>Geralmente, em regressão múltipla é interessante selecionar um modelo com os melhores preditores, de forma a melhorar a capacidade preditiva do modelo. Além do <span class="math inline">\(R^2_{aj}\)</span>, outras métricas podem ser usadas, por exemplo o critério de informação de Akaike, AIC. O AIC considera o número de parâmetros e o erro do modelo, sendo esta uma métrica mais interessante para seleção de modelos.</p>
<p><span class="math display">\[
AIC = T\text{ log}\bigg(\frac{SS_E}{T}\bigg)+2(k+2)
\]</span></p>
<p>A <a href="#tbl-fit_petro" class="quarto-xref">Tabela&nbsp;<span>4.2</span></a> apresenta os resultados de AIC, AIC corrigido e <span class="math inline">\(R^2_{aj}\)</span> para o modelo completo e o modelo reduzido. O modelo reduzido apresentou melhor resultado, uma vez que minimiza AIC e AICc.</p>
<div class="cell">
<div id="tbl-fit_petro" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-fit_petro-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Tabela&nbsp;4.2: <span class="math inline">\(R^2_{aj}\)</span>, AIC e AIC corrigido para os modelos
</figcaption>
<div aria-describedby="tbl-fit_petro-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">model</th>
<th style="text-align: right;">adj_r_squared</th>
<th style="text-align: right;">AIC</th>
<th style="text-align: right;">AICc</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">completo</td>
<td style="text-align: right;">0,9480198</td>
<td style="text-align: right;">7167,001</td>
<td style="text-align: right;">7168,715</td>
</tr>
<tr class="even">
<td style="text-align: left;">reduzido</td>
<td style="text-align: right;">0,9558487</td>
<td style="text-align: right;">7115,814</td>
<td style="text-align: right;">7116,917</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
<p>A forma correta de realizar a remoção de coeficientes, não é considerando a significância. Ademais, não sugere-se a remoção manual de coeficientes. Recomenda-se o uso de um algoritmo para tal fim. O algoritmo <em>stepwise</em> com eliminação para trás segue os seguintes passos:</p>
<ol type="1">
<li>Comece com o modelo completo.</li>
<li>Remova um preditor por vez. Mantenha o modelo com melhor desempenho, considerando por exemplo o AIC.</li>
<li>Repita o procedimento até encontrar o melhor modelo.</li>
</ol>
</section>
<section id="previsão" class="level2" data-number="4.7">
<h2 data-number="4.7" class="anchored" data-anchor-id="previsão"><span class="header-section-number">4.7</span> Previsão</h2>
<p>A previsão à frente não é geralmente possível quando se considera outras séries como preditoras, uma vez que não se conhece os valores futuros das séries. Por exemplo, no último caso do petróleo e derivados, os derivados vêm depois, sendo mais útil para previsão do volume refinado um modelo que considere ou a decomposição ou outros métodos mais sofisticados ainda não abordados, os quais levam em conta a autocorrelação da série. Entretanto, nos casos de regressão onde se utiliza como preditores a tendência e a sazonalidade a partir de variáveis <em>dummy</em>, é possível realizar a previsão à frente. A <a href="#fig-temp_pred_" class="quarto-xref">Figura&nbsp;<span>4.16</span></a> expõe a previsão de dois dias à frente para a temperatura de São joão del-Rei utilizando o modelo anteriormente obtido.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-temp_pred_" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-temp_pred_-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="ST4_files/figure-html/fig-temp_pred_-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-temp_pred_-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;4.16: Previsão da temperatura em São João del-Rei
</figcaption>
</figure>
</div>
</div>
</div>
<p>Apesar de não ser possível realizar previsões à frente para casos de regressão considerando outras séries temporais como preditoras, é possível realizar nestes casos previsões baseadas em cenários. Seja o caso exposto anteriormente onde deseja-se prever a venda de fertilizantes. A <span class="quarto-unresolved-ref">?fig-prev_cenar</span> expõe a previsão para dois cenários, um de aumento e outro de decréscimo nos índices de produção de bens de capital e intermediários. Este tipo de análise pode ser útil para adiantar possíveis cenários e viabilizar ações de planejamento.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-fert_cenar" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-fert_cenar-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="ST4_files/figure-html/fig-fert_cenar-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-fert_cenar-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;4.17: Previsão de cenários para venda de fertilizantes
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="regressão-não-linear" class="level2" data-number="4.8">
<h2 data-number="4.8" class="anchored" data-anchor-id="regressão-não-linear"><span class="header-section-number">4.8</span> Regressão não linear</h2>
<p>Transformações podem ser interessantes para tratar a não lineariedade na série a ser predita e nas preditoras. Há muitos casos que a tendência observada em uma série não é linear. Nestes casos podem ser considerada transformação polinomial na tendência.</p>
<p>Uma opção interessante em alguns casos é utilizar transformação logarítimica em ambas séries independentes e dependente ou em apenas uma destas. Para o caso simples, com transformação em ambas as séries, tem-se o seguinte modelo.</p>
<p><span class="math display">\[
\text{log} (y_t) = \beta_0+\beta_1\text{log} (x_t)
\]</span></p>
<p>Pode-se pensar em considerar um termo quadrático ou de ordem maior para a tendência, de forma a contemplar uma tendência não linear. Entretanto, não se recomenda tal estratégia, uma vez que na maioria dos casos a previsão resultante extrapola muito a realidade.</p>
<p><span class="math display">\[
\hat{y}_t = \beta_0+\beta_{1}t+\beta_{2}t^2
\]</span></p>
<p>Uma abordagem mais interessante é pensar em modelos lineares por partes, de forma a considerar modelos lineares distintos em cada parte do horizonte temporal da série, consistindo em um modelo não linear formado por peças lineares (<em>piecewise regression</em>). Por exemplo, um modelo com uma divisão no tempo, <span class="math inline">\(\tau\)</span>, ´pode ser descrito conforme segue:</p>
<p><span class="math display">\[
\hat{y}_t = \beta_0+\beta_{1}t+\beta_{2}(t-\tau)_+,
\]</span> onde:</p>
<p><span class="math display">\[
(t-\tau)_+ = \bigg\{
\begin{align} 0 \text{, se } t&lt; \tau \\
              t-\tau \text{, se } t\geq \tau
\end{align}
\]</span></p>
<p>Na <a href="#fig-emissagro" class="quarto-xref">Figura&nbsp;<span>4.18</span></a> é exibida a série temporal de emissões de gases de efeito estufa devido a produção de energia no Brasil. Os dados tem frequência anual e são disponibilizados desde 1990 até 2020 em <a href="https://dados.gov.br/dados/conjuntos-dados/sirene">SIRENE - Sistema de Registro Nacional de Emissões</a>. As emissões são disponibilizadas em giga gramas (Gg) de dióxido de carbono equivalente. Observa-se tendência de aumento até 2014 e queda a partir de então.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-emissagro" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-emissagro-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="ST4_files/figure-html/fig-emissagro-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-emissagro-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;4.18: Emissões de gases de efeito estufa por atividades de produção de energia no Brasil
</figcaption>
</figure>
</div>
</div>
</div>
<p>A <a href="#fig-emissagro_mod" class="quarto-xref">Figura&nbsp;<span>4.19</span></a> expõe a mesma série com três modelos, um com transformação logarítimica na resposta, resultando em um modelo exponencial, um modelo linear e outro linear por partes (<em>piecewise</em>). Para os três modelos foram utilizados dados de até 2017 para treinamento. Para o modelo por partes foram consideradas duas partições, em 2005 e 2014. Foi realizada a previsão para 5 anos a partir de 2018. Pode-se observar que o terceiro caso parece mais interessante pois ajusta-se melhor à queda observada nos últimos anos.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-emissagro_mod" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-emissagro_mod-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="ST4_files/figure-html/fig-emissagro_mod-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-emissagro_mod-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;4.19: Emissões de gases de efeito estufa por atividades de produção de energia no Brasil
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="implementação-em-r" class="level2" data-number="4.9">
<h2 data-number="4.9" class="anchored" data-anchor-id="implementação-em-r"><span class="header-section-number">4.9</span> Implementação em R</h2>
<p>A seguir são apresentadas boa parte das implementações na linguagem R para obter os dados, gráficos e análises expostos no presente capítulo.</p>
<p>Carregando pacotes.</p>
<p>Séries temporais anuais de área plantada em hectare e grãos produzidos em toneladas. O pacote <code>ipeadatar</code> disponibiliza diversas séries econométricas via função <code>ipeadata</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># metadata("DEPAE_SAFRA")</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="co"># available_series()</span></span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>graos_plan <span class="ot">&lt;-</span> <span class="fu">ipeadata</span>(<span class="st">"DEPAE_SAFRAAREA"</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>graos_prod <span class="ot">&lt;-</span> <span class="fu">ipeadata</span>(<span class="st">"DEPAE_SAFRA"</span>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Transformando as séries em <code>tsibble</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>graos  <span class="ot">&lt;-</span> <span class="fu">tsibble</span>(<span class="at">valor =</span> <span class="fu">c</span>(graos_plan<span class="sc">$</span>value,</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>                            graos_prod<span class="sc">$</span>value),</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">data =</span> <span class="fu">yearmonth</span>(<span class="fu">c</span>(graos_plan<span class="sc">$</span>date,</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>                                     graos_prod<span class="sc">$</span>date)),</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>                  <span class="at">id =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">"area_plantada"</span>, <span class="fu">nrow</span>(graos_plan)),</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">rep</span>(<span class="st">"producao"</span>, <span class="fu">nrow</span>(graos_prod))),</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>                  <span class="at">key=</span>id, <span class="at">index=</span>data)</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>id.labs <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"área plantada [ha]"</span>, <span class="st">"produção [ton]"</span>)</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(id.labs) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"area_plantada"</span>, <span class="st">"producao"</span>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Visualizando as séries.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>graos <span class="sc">|&gt;</span> <span class="fu">autoplot</span>(valor) <span class="sc">+</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># geom_line(col = "slategrey") +</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="at">nrow=</span><span class="dv">2</span>, <span class="sc">~</span> id, <span class="at">scales =</span> <span class="st">"free_y"</span>,</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">labeller =</span> <span class="fu">labeller</span>(<span class="at">id =</span> id.labs)) <span class="sc">+</span> </span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">colour =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">""</span>, <span class="at">x =</span> <span class="st">""</span>, <span class="at">title =</span> <span class="st">"Produção de grãos no Brasil"</span>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Diagrama de dispersão e correlação entre as séries.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>df_graos <span class="ot">&lt;-</span> graos <span class="sc">|&gt;</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>            <span class="fu">pivot_wider</span>(<span class="at">names_from=</span>id,</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>                        <span class="at">values_from=</span>valor)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggpairs</span>(df_graos, <span class="at">columns =</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Modelo de regressão linear simples para produção em função da área plantada. Deve-se usar o comando <code>TSLM</code>. O modelo deve conter a série dependente e as indepndentes após <code>~</code>. Neste caso há uma única série independente ou exógena, <code>area_plantada</code>. Porém, em casos onde há múltiplas séries exógenas, é importante usar <code>+</code> para separá-las.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>fit_graos <span class="ot">&lt;-</span> df_graos <span class="sc">|&gt;</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model</span>(<span class="fu">TSLM</span>(producao <span class="sc">~</span> area_plantada))</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="fu">report</span>(fit_graos)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Série ajustada para produção de grãos a partir do modelo de regressão obtido.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_graos) <span class="sc">|&gt;</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> data)) <span class="sc">+</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> producao, <span class="at">colour =</span> <span class="st">"Data"</span>)) <span class="sc">+</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> .fitted, <span class="at">colour =</span> <span class="st">"Fitted"</span>)) <span class="sc">+</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Grãos [ton]"</span>,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Produção de grãos"</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="at">Data=</span><span class="st">"grey"</span>,<span class="at">Fitted=</span><span class="st">"slateblue"</span>)) <span class="sc">+</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">colour =</span> <span class="fu">guide_legend</span>(<span class="at">title =</span> <span class="cn">NULL</span>))</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Resíduos para o modelo de produção de grãos.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>fit_graos <span class="sc">|&gt;</span> <span class="fu">gg_tsresiduals</span>()</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Série temporal de temperatura de São João del-Rei.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>tempo_sjdr <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"sjdr2024.csv"</span>,</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>                       <span class="at">header=</span>T)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>tempo_sjdr_ts <span class="ot">&lt;-</span> tempo_sjdr <span class="sc">|&gt;</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Data =</span> <span class="fu">as.POSIXct</span>(<span class="fu">paste</span>(Data,Hora), </span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>                           <span class="at">format =</span> <span class="st">"%Y/%m/%d %H"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">!</span>Hora) <span class="sc">|&gt;</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tsibble</span>(<span class="at">index =</span> Data)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>data_inicial <span class="ot">&lt;-</span> <span class="fu">as.POSIXct</span>(<span class="st">"2024-06-15 00:00:00"</span>)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>datas_especificas <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> data_inicial, <span class="at">by =</span> <span class="st">"hour"</span>, <span class="at">length.out =</span> <span class="dv">14</span><span class="sc">*</span><span class="dv">24</span>)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>tempo_sjdr_14_dias <span class="ot">&lt;-</span> tempo_sjdr_ts <span class="sc">|&gt;</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Data <span class="sc">%in%</span> datas_especificas)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Modelo de regressão com termo de tendência e sazonalidade. São usados para tal os termos <code>trend()</code> e <code>season()</code>. O segundo cria as variáveis <em>dummy</em> necessárias para capturar a sazonalidade na regressão.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>fit_tempo <span class="ot">&lt;-</span> tempo_sjdr_14_dias <span class="sc">|&gt;</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model</span>(<span class="fu">TSLM</span>(Temperatura <span class="sc">~</span> <span class="fu">trend</span>() <span class="sc">+</span> <span class="fu">season</span>()))</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="fu">report</span>(fit_tempo)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Série aproximada.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit_tempo) <span class="sc">|&gt;</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Data)) <span class="sc">+</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> Temperatura, <span class="at">colour =</span> <span class="st">"Data"</span>)) <span class="sc">+</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> .fitted, <span class="at">colour =</span> <span class="st">"Fitted"</span>)) <span class="sc">+</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(<span class="at">Data =</span> <span class="st">"black"</span>, <span class="at">Fitted =</span> <span class="st">"orangered"</span>)</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">colour =</span> <span class="fu">guide_legend</span>(<span class="at">title =</span> <span class="st">"Series"</span>)) <span class="sc">+</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">""</span>, <span class="at">y =</span> <span class="st">"Temp [°C]"</span>,</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">title=</span><span class="st">"Temperatura em São João del-Rei"</span>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Previsão do tempo.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>fc_tempo <span class="ot">&lt;-</span> <span class="fu">forecast</span>(fit_tempo)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>fc_tempo <span class="sc">|&gt;</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(tempo_sjdr_14_dias) <span class="sc">+</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Previsão do tempo para São João del-Rei"</span>,</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Temp [°C]"</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Série de produção de petróleo e derivados.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>petro <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"petroleo_e_derivados.csv"</span>, <span class="at">header=</span>T)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>petro <span class="ot">&lt;-</span> petro <span class="sc">|&gt;</span> <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(gasolina_aviao,</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>                            outros_energeticos))</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>petro_ts <span class="ot">&lt;-</span> petro <span class="sc">|&gt;</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> petroleo<span class="sc">:</span>solvente) <span class="sc">|&gt;</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">as.Date</span>(data, <span class="at">format=</span><span class="st">"%m/%d/%Y"</span>))</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>petro_ts <span class="ot">&lt;-</span> petro_ts <span class="sc">|&gt;</span> </span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tsibble</span>(<span class="at">key =</span> name, </span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>             <span class="at">index =</span> data)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>petro_ <span class="ot">&lt;-</span> petro_ts <span class="sc">|&gt;</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from=</span>name,</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>              <span class="at">values_from=</span>value)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>petro_ts <span class="sc">|&gt;</span> <span class="fu">autoplot</span>(value) <span class="sc">+</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="at">nrow=</span><span class="dv">14</span>, <span class="sc">~</span> name, <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">colour =</span> <span class="st">"none"</span>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Correlação entre as séries. Usa-se o comando <code>corrplot</code> do pacote homônimo.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>R <span class="ot">&lt;-</span> <span class="fu">cor</span>(petro[,<span class="dv">2</span><span class="sc">:</span><span class="dv">15</span>])</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="fu">corrplot</span>(R, <span class="at">method =</span> <span class="st">'color'</span>, <span class="at">order =</span> <span class="st">'hclust'</span>, <span class="at">type =</span> <span class="st">'upper'</span>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Modelo de regressão múltipla da série de produção de petróleo em função dos derivados.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>fit_petro <span class="ot">&lt;-</span> petro_ <span class="sc">|&gt;</span> </span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model</span>(<span class="fu">TSLM</span>(petroleo <span class="sc">~</span> .<span class="sc">-</span>petroleo<span class="sc">-</span>data))</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">report</span>(fit_petro)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Série temporal de emissões de gases de efeito estufa por produção de energia no Brasil.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>emissoes <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"emissoes.csv"</span>, <span class="at">header =</span> T)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>emissoes_ts <span class="ot">&lt;-</span> emissoes <span class="sc">|&gt;</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Ano =</span> <span class="fu">year</span>(<span class="fu">as.Date</span>(<span class="fu">paste</span>(Ano,<span class="st">"01 01"</span>), <span class="at">format =</span> <span class="st">"%Y %m %d"</span>))) <span class="sc">|&gt;</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tsibble</span>(<span class="at">index =</span> Ano)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Modelos com tendência linear, exponencial e de regressão por partes. Para o último deve-se definir os <em>knots</em> ou divisões e provê-los como argumento em <code>trend</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>knots <span class="ot">&lt;-</span> <span class="fu">year</span>(<span class="fu">as.Date</span>(<span class="fu">c</span>(<span class="st">"2005-01-01"</span>, <span class="st">"2014-01-01"</span>), <span class="at">format=</span><span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>fit_trends <span class="ot">&lt;-</span> emissoes_ts <span class="sc">|&gt;</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter_index</span>(<span class="sc">~</span><span class="st">"2017"</span>) <span class="sc">|&gt;</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model</span>(</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">linear =</span> <span class="fu">TSLM</span>(Energia <span class="sc">~</span> <span class="fu">trend</span>()),</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">exponencial =</span> <span class="fu">TSLM</span>(<span class="fu">log</span>(Energia) <span class="sc">~</span> <span class="fu">trend</span>()),</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">linear por partes</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">TSLM</span>(Energia <span class="sc">~</span> <span class="fu">trend</span>(<span class="at">knots =</span> knots))</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>fc_trends <span class="ot">&lt;-</span> fit_trends <span class="sc">|&gt;</span> <span class="fu">forecast</span>(<span class="at">h =</span> <span class="dv">5</span>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Visualizando a série com as previsões.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>emissoes_ts <span class="sc">|&gt;</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(Energia) <span class="sc">+</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> <span class="fu">fitted</span>(fit_trends),</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">y =</span> .fitted, <span class="at">colour =</span> .model)) <span class="sc">+</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autolayer</span>(fc_trends, <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">level =</span> <span class="cn">NULL</span>) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"Ano"</span>, <span class="at">y=</span><span class="st">"Gg de CO2e"</span>, <span class="at">title=</span><span class="st">"Emissões de gases de efeito estufa na produção de energia no Brasil"</span>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="exercícios-propostos" class="level2" data-number="4.10">
<h2 data-number="4.10" class="anchored" data-anchor-id="exercícios-propostos"><span class="header-section-number">4.10</span> Exercícios propostos</h2>
<p>O código à seguir é utilizado para obter as séries de fertilizantes apresentadas neste capítulo.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>fert_venda <span class="ot">&lt;-</span> <span class="fu">ipeadata</span>(<span class="st">"ANDA12_VFERTILIZ12"</span>)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>fert_prod <span class="ot">&lt;-</span> <span class="fu">ipeadata</span>(<span class="st">"ANDA12_PFERTILIZ12"</span>)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>fert_exp <span class="ot">&lt;-</span> <span class="fu">ipeadata</span>(<span class="st">"ANDA12_NPKFERTILIZ12"</span>)</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>fert_imp <span class="ot">&lt;-</span> <span class="fu">ipeadata</span>(<span class="st">"ANDA12_MFERTILIZ12"</span>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>fert  <span class="ot">&lt;-</span> <span class="fu">tsibble</span>(<span class="at">valor =</span> <span class="fu">c</span>(fert_venda<span class="sc">$</span>value,</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>                           fert_prod<span class="sc">$</span>value,</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>                           fert_exp<span class="sc">$</span>value,</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>                           fert_imp<span class="sc">$</span>value</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>                           ),</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>                  <span class="at">data =</span> <span class="fu">yearmonth</span>(<span class="fu">c</span>(fert_venda<span class="sc">$</span>date,</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>                                     fert_prod<span class="sc">$</span>date,</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>                                     fert_exp<span class="sc">$</span>date,</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>                                     fert_imp<span class="sc">$</span>date</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>                                     )),</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>                  <span class="at">id =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">"vendas"</span>, <span class="fu">nrow</span>(fert_venda)),</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">rep</span>(<span class="st">"producao"</span>, <span class="fu">nrow</span>(fert_prod)),</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">rep</span>(<span class="st">"exportacao"</span>, <span class="fu">nrow</span>(fert_exp)),</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">rep</span>(<span class="st">"importacao"</span>, <span class="fu">nrow</span>(fert_imp))),</span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>                  <span class="at">key=</span>id, <span class="at">index=</span>data)</span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>id.labs <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Vendas"</span>, <span class="st">"Produção"</span>, <span class="st">"Exportação"</span>, <span class="st">"Importação"</span>)</span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(id.labs) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"vendas"</span>, <span class="st">"producao"</span>, <span class="st">"exportacao"</span>, <span class="st">"importacao"</span>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol type="1">
<li>Obtenha um modelo para prever o volume de vendas de fertilizantes em função dos volumes de produção, importação e exportação a partir de 2013 até o fim de 2023. Use <code>filter_index(~ "2023-12")</code> para definir o horizonte de tempo. Use o modelo <code>vendas ~ producao + importacao + exportacao</code> em <code>TSLM</code>. Interprete o modelo obtido.</li>
</ol>
<ol start="2" type="1">
<li>Se algum termo não for significativo, refaça o modelo desconsiderando-o e compare os modelos obtidos.</li>
</ol>
<ol start="3" type="1">
<li>Obtenha um modelo para a venda de fertilizantes em função apenas da tendência e sazonalidade da própria série.</li>
</ol>
<p>O código a seguir obtém <span class="math inline">\(R^2_{aj}\)</span>, AIC e AICc dos modelos (adapte os nomes dos três modelos, segundo seu código).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>fit1 <span class="ot">&lt;-</span> <span class="fu">glance</span>(fit_fert) <span class="sc">|&gt;</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(adj_r_squared, AIC, AICc)</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>fit2 <span class="ot">&lt;-</span> <span class="fu">glance</span>(fit_fert2) <span class="sc">|&gt;</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(adj_r_squared, AIC, AICc)</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>fit3 <span class="ot">&lt;-</span> <span class="fu">glance</span>(fit_fert3) <span class="sc">|&gt;</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(adj_r_squared, AIC, AICc)</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(fit1,fit2,fit3) <span class="sc">|&gt;</span></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">model =</span> <span class="fu">c</span>(<span class="st">"completo"</span>, <span class="st">"reduzido"</span>, <span class="st">"tredn+season"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(model)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="4" type="1">
<li>Faça a análise de resíduos para o melhor modelo obtido.</li>
</ol>
<ol start="5" type="1">
<li>Compare a capacidade de previsão dos modelos considerando dados de janeiro de 2024 até maio de 2025 como dados de teste. Use o argumento <code>new_data</code> em <code>forecast</code> e forneça a série de 17 observações para os modelos que dependem das variáveis exógenas. Para o último modelo forneça apenas <code>h=17</code>.</li>
</ol>
<ol start="6" type="1">
<li>Faça um modelo de regressão para a série de produção de bens de consumo duráveis em função da série de bens de capital e da série de bens intermediários. Interprete o modelo obtido.</li>
</ol>
<ol start="7" type="1">
<li>Faça a análise dos resíduos para o modelo obtido no exercício anterior. Interprete os resultados.</li>
</ol>
<ol start="8" type="1">
<li>Obtenha os valores ajustados e visualize-os junto à série de bens de consumo duráveis.</li>
</ol>
<p>A seguir expõe-se o código para realizar a previsão baseada em cenários para o modelo de regressão para produção de grãos em função da área plantada. Foram considerados dois cenários: um de aumento na área plantada nos dois próximos anos com 82000 e 85000 hectares plantados; outro de queda na área plantada nos dois próximos anos com 75000 e 72000 hectares.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>future_scenarios <span class="ot">&lt;-</span> <span class="fu">scenarios</span>(</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">Aumento =</span> <span class="fu">new_data</span>(df_graos, <span class="dv">2</span>) <span class="sc">|&gt;</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">area_plantada =</span> <span class="fu">c</span>(<span class="dv">82000</span>,<span class="dv">85000</span>)),</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">Queda =</span> <span class="fu">new_data</span>(df_graos, <span class="dv">2</span>) <span class="sc">|&gt;</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">area_plantada =</span> <span class="fu">c</span>(<span class="dv">75000</span>, <span class="dv">72000</span>)),</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">names_to =</span> <span class="st">"Cenários"</span>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>fc <span class="ot">&lt;-</span> <span class="fu">forecast</span>(fit_graos, <span class="at">new_data =</span> future_scenarios)</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>df_graos <span class="sc">|&gt;</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(producao) <span class="sc">+</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autolayer</span>(fc, <span class="at">level =</span> <span class="dv">95</span>) <span class="sc">+</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Previsão de cenários para produção de grãos"</span>, <span class="at">y =</span> <span class="st">""</span>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="9" type="1">
<li>Faça uma previsão de cenários usando o modelo de regressão para a série de produção de bens de consumo duráveis. Considere três meses à frente e um cenários de queda e outro de aumento nos índices de produção de bens de capital e da série de bens intermediários. A seguir expõe-se como seria implementado um cenário para este caso de regressão múltipla.</li>
</ol>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copiada");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copiada");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./ST3.html" class="pagination-link" aria-label="Decomposição de séries temporais">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Decomposição de séries temporais</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./ST5.html" class="pagination-link" aria-label="Suavização exponencial">
        <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Suavização exponencial</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>